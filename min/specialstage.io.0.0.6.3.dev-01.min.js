var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(D,S,aa){if(D==Array.prototype||D==Object.prototype)return D;D[S]=aa.value;return D};
$jscomp.getGlobal=function(D){D=["object"==typeof globalThis&&globalThis,D,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var S=0;S<D.length;++S){var aa=D[S];if(aa&&aa.Math==Math)return aa}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;
$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(D,S){var aa=$jscomp.propertyToPolyfillSymbol[S];if(null==aa)return D[S];aa=D[aa];return void 0!==aa?aa:D[S]};$jscomp.polyfill=function(D,S,aa,ha){S&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(D,S,aa,ha):$jscomp.polyfillUnisolated(D,S,aa,ha))};
$jscomp.polyfillUnisolated=function(D,S,aa,ha){aa=$jscomp.global;D=D.split(".");for(ha=0;ha<D.length-1;ha++){var ta=D[ha];if(!(ta in aa))return;aa=aa[ta]}D=D[D.length-1];ha=aa[D];S=S(ha);S!=ha&&null!=S&&$jscomp.defineProperty(aa,D,{configurable:!0,writable:!0,value:S})};
$jscomp.polyfillIsolated=function(D,S,aa,ha){var ta=D.split(".");D=1===ta.length;ha=ta[0];ha=!D&&ha in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var Ka=0;Ka<ta.length-1;Ka++){var Qa=ta[Ka];if(!(Qa in ha))return;ha=ha[Qa]}ta=ta[ta.length-1];aa=$jscomp.IS_SYMBOL_NATIVE&&"es6"===aa?ha[ta]:null;S=S(aa);null!=S&&(D?$jscomp.defineProperty($jscomp.polyfills,ta,{configurable:!0,writable:!0,value:S}):S!==aa&&(void 0===$jscomp.propertyToPolyfillSymbol[ta]&&(aa=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[ta]=
$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(ta):$jscomp.POLYFILL_PREFIX+aa+"$"+ta),$jscomp.defineProperty(ha,$jscomp.propertyToPolyfillSymbol[ta],{configurable:!0,writable:!0,value:S})))};$jscomp.underscoreProtoCanBeSet=function(){var D={a:!0},S={};try{return S.__proto__=D,S.a}catch(aa){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(D,S){D.__proto__=S;if(D.__proto__!==S)throw new TypeError(D+" is not extensible");return D}:null;$jscomp.arrayIteratorImpl=function(D){var S=0;return function(){return S<D.length?{done:!1,value:D[S++]}:{done:!0}}};$jscomp.arrayIterator=function(D){return{next:$jscomp.arrayIteratorImpl(D)}};
$jscomp.makeIterator=function(D){var S="undefined"!=typeof Symbol&&Symbol.iterator&&D[Symbol.iterator];return S?S.call(D):$jscomp.arrayIterator(D)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(D){if(!(D instanceof Object))throw new TypeError("Iterator result "+D+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(D){this.yieldResult=D};$jscomp.generator.Context.prototype.throw_=function(D){this.abruptCompletion_={exception:D,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype["return"]=function(D){this.abruptCompletion_={"return":D};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(D){this.abruptCompletion_={jumpTo:D};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(D,S){this.nextAddress=S;return{value:D}};
$jscomp.generator.Context.prototype.yieldAll=function(D,S){var aa=$jscomp.makeIterator(D),ha=aa.next();$jscomp.generator.ensureIteratorResultIsObject_(ha);if(ha.done)this.yieldResult=ha.value,this.nextAddress=S;else return this.yieldAllIterator_=aa,this.yield(ha.value,S)};$jscomp.generator.Context.prototype.jumpTo=function(D){this.nextAddress=D};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};
$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(D,S){this.catchAddress_=D;void 0!=S&&(this.finallyAddress_=S)};$jscomp.generator.Context.prototype.setFinallyBlock=function(D){this.catchAddress_=0;this.finallyAddress_=D||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(D,S){this.nextAddress=D;this.catchAddress_=S||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(D){this.catchAddress_=D||0;D=this.abruptCompletion_.exception;this.abruptCompletion_=null;return D};$jscomp.generator.Context.prototype.enterFinallyBlock=function(D,S,aa){aa?this.finallyContexts_[aa]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=D||0;this.finallyAddress_=S||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(D,S){var aa=this.finallyContexts_.splice(S||0)[0];if(aa=this.abruptCompletion_=this.abruptCompletion_||aa){if(aa.isException)return this.jumpToErrorHandler_();void 0!=aa.jumpTo&&this.finallyAddress_<aa.jumpTo?(this.nextAddress=aa.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=D};$jscomp.generator.Context.prototype.forIn=function(D){return new $jscomp.generator.Context.PropertyIterator(D)};
$jscomp.generator.Context.PropertyIterator=function(D){this.object_=D;this.properties_=[];for(var S in D)this.properties_.push(S);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var D=this.properties_.pop();if(D in this.object_)return D}return null};$jscomp.generator.Engine_=function(D){this.context_=new $jscomp.generator.Context;this.program_=D};
$jscomp.generator.Engine_.prototype.next_=function(D){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,D,this.context_.next_);this.context_.next_(D);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(D){this.context_.start_();var S=this.context_.yieldAllIterator_;if(S)return this.yieldAllStep_("return"in S?S["return"]:function(aa){return{value:aa,done:!0}},D,this.context_["return"]);this.context_["return"](D);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(D){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],D,this.context_.next_);this.context_.throw_(D);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(D,S,aa){try{var ha=D.call(this.context_.yieldAllIterator_,S);$jscomp.generator.ensureIteratorResultIsObject_(ha);if(!ha.done)return this.context_.stop_(),ha;var ta=ha.value}catch(Ka){return this.context_.yieldAllIterator_=null,this.context_.throw_(Ka),this.nextStep_()}this.context_.yieldAllIterator_=null;aa.call(this.context_,ta);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var D=this.program_(this.context_);if(D)return this.context_.stop_(),{value:D.value,done:!1}}catch(S){this.context_.yieldResult=void 0,this.context_.throw_(S)}this.context_.stop_();if(this.context_.abruptCompletion_){D=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(D.isException)throw D.exception;return{value:D["return"],done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(D){this.next=function(S){return D.next_(S)};this["throw"]=function(S){return D.throw_(S)};this["return"]=function(S){return D.return_(S)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(D,S){var aa=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(S));$jscomp.setPrototypeOf&&D.prototype&&$jscomp.setPrototypeOf(aa,D.prototype);return aa};
$jscomp.asyncExecutePromiseGenerator=function(D){function S(ha){return D.next(ha)}function aa(ha){return D["throw"](ha)}return new Promise(function(ha,ta){function Ka(Qa){Qa.done?ha(Qa.value):Promise.resolve(Qa.value).then(S,aa).then(Ka,ta)}Ka(D.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(D){return $jscomp.asyncExecutePromiseGenerator(D())};$jscomp.asyncExecutePromiseGeneratorProgram=function(D){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(D)))};
(function(){function D(){var e=this;this.BINDINGS=this.GAMEPAD=this.TRACK=this.BACK=this.HIDE=this.ESC=this.CTRL=this.SHIFT=this.SPACE=this.ENTER=this.RIGHT=this.LEFT=this.FORWARD=this.BACK=this.DOWN=this.UP=this.MOBILE=!1;this.touches=[];var b="";this.connect=function(){this.MOBILE?(window.addEventListener("touchstart",e.touch,!1),window.addEventListener("touchmove",e.touch,!1),window.addEventListener("touchend",e.touch,!1)):(window.addEventListener("keydown",e.key,!1),window.addEventListener("keyup",
e.key,!1),window.addEventListener("mousedown",e.mousedown),window.addEventListener("mouseup",e.mouseup,!1),window.addEventListener("touchstart",e.touchSetup,!1))};this.disconnect=function(){window.removeEventListener("keydown",e.key,!1);window.removeEventListener("keyup",e.key,!1);window.removeEventListener("mousedown",e.mousedown,!1);window.removeEventListener("mouseup",e.mouseup,!1);window.removeEventListener("touchstart",e.touchSetup,!1);window.removeEventListener("touchstart",e.touch,!1);window.removeE;
ventListener("touchmove",e.touch,!1);window.removeEventListener("touchend",e.touch,!1)};this.key=function(l){var k="keydown"==l.type;switch(k||(b+=l.key),3<b.length&&(b=b.slice(1,4)),l.key){case "ArrowUp":e.UP=k;break;case "ArrowDown":e.DOWN=k;break;case "ArrowLeft":e.LEFT=k;break;case "ArrowRight":e.RIGHT=k;break;case "w":e.UP=k;break;case "s":e.DOWN=k;break;case "a":e.LEFT=k;break;case "d":e.RIGHT=k;break;case "r":e.RESET=k;break;case " ":e.SPACE=k;break;case "Shift":e.SHIFT=k;break;case "1":uas.CAM=
1;break;case "2":uas.CAM=2;break;case "3":uas.CAM=3;break;case "4":uas.CAM=4;break;case "5":uas.CAM=5;break;case "6":uas.CAM=6;break;case "7":uas.CAM=7;break;case "8":uas.CAM=8;break;case "9":uas.CAM=9;break;case "0":uas.CAM=10;break;case "Enter":e.ENTER=k;break;case "Control":e.CTRL=k;break;case "Escape":case "Backspace":e.ESC=k;break;case "=":e.ZOOM_IN=k;break;case "-":e.ZOOM_OUT=k;break;case "t":e.TARGET=k;break;case "h":e.HIDE=k;break;case ">":!k&&2>La&&(La+=.5);ha();break;case "<":!k&&.5<La&&
(La-=.5),ha()}!z.REPLAY||va||Fa||"vhs"===b&&(a.print("code detected: ghost data overwrite","2","2"),window.setTimeout(ya["export"],1E3,T.results,!1),b="")};this.mousedown=function(l){l.preventDefault();e.touches[0]={x:l.clientX,y:l.clientY,start:!0}};this.mouseup=function(l){l.preventDefault();e.touches[0]={x:l.clientX,y:l.clientY,start:!1}};this.touchSetup=function(l){window.removeEventListener("keydown",e.key,!1);window.removeEventListener("keyup",e.key,!1);window.removeEventListener("keyup",e.key,
!1);window.removeEventListener("mousedown",e.mousedown,!1);window.removeEventListener("mouseup",e.mouseup,!1);window.removeEventListener("touchstart",e.touchSetup,!1);window.addEventListener("touchstart",e.touchstart,!1);window.addEventListener("touchmove",e.touchmove,!1);window.addEventListener("touchend",e.touchend,!1);e.touchstart(l)};this.clear=function(){e.touches=[];this.ENTER=this.RIGHT=this.LEFT=this.DOWN=this.UP=!1};this.touchstart=function(l){l=l.touches;e.touches=[];for(var k=0;k<l.length;k++)e.touches[k]=
{x:l[k].clientX,y:l[k].clientY,start:!0}};this.touchmove=function(l){e.touches=[];l=l.touches;for(var k=0;k<l.length;k++)e.touches[k]={x:l[k].clientX,y:l[k].clientY,start:!1}};this.touchend=function(l){e.touches=[];l=l.touches;for(var k=0;k<l.length;k++)e.touches[k]={x:l[k].clientX,y:l[k].clientY,start:!1}}}function S(){var e=(scope=this).SEED=0;this.length=480;var b=[],l=0;this.BIOMES=b;this.BIOME=0;b[0]={name:"pine",palette:ja[9],tree:function(u,t){return scope.pine()},limit:Math.floor(scope.length/
2),range:5,map:[],flags:[]};b[0].map[0]=function(u,t){var r=ja[10],K=!1;return.92<Math.abs(u)&&(r=.92<Math.abs(u)?ja[9]:ja[2],K=!0),b[0].flags[t]=K,r};b[1]={name:"cherry blossom",palette:ja[12],tree:function(){return scope.sakura()},limit:Math.floor(1/6*scope.length),range:10,map:[],flags:[]};b[1].map[0]=function(u,t){var r=ja[1],K=!1;return.95<Math.abs(u)&&(r=.92<Math.abs(u)?ja[12]:ja[1],K=!0),b[1].flags[t]=K,r};b[2]={name:"ice",palette:ja[1],tree:function(){return new THREE.Geometry},limit:0,range:10,
map:[],flags:[]};b[2].map[0]=function(u,t){var r=ja[7],K=!1;return.95<Math.abs(u)&&(r=.92<Math.abs(u)?ja[2]:ja[7],K=!0),b[2].flags[t]=K,r};var k=new THREE.Points(new THREE.Geometry);k.name="Generative Extruder";k.visible=!1;var q=new THREE.Line(new THREE.Geometry);q.name="Generative Nodes";q.visible=!1;q.material.color=ja[6];q.material.name="Node Material";q.position.z+=2;var x=new THREE.LineSegments(new THREE.Geometry);x.name="Generative Segments";x.visible=!0;x.material.color=ja[3];x.material.name=
"Segments Material";var n=new THREE.Mesh(new THREE.Geometry);n.name="Generative Surface";n.visible=!1;n.material.color=ja[0];n.material.name="Surface Material";var E=new THREE.LineSegments(new THREE.Geometry);E.name="Generative Perimeter";E.material.color=ja[1];E.material.name="Perimeter Material";var B=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));B.name="Terrain";B.material.name="Terrain Material";B.material.wireframe=!0;B.material.side=THREE.DoubleSide;
B.visible=!0;wireframe=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial({vertexColors:THREE.VertexColors}));wireframe.name="Wireframe";wireframe.material.name="Wireframe Material";wireframe.material.wireframe=!0;wireframe.material.side=THREE.FrontSide;wireframe.visible=!0;var y=new THREE.LineSegments(new THREE.Geometry,new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}));y.name="Trees";var g=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);g.name="Background";
g.material.color=ja[0];g.material.name="Background Material";g.material.wireframe=!1;g.material.side=THREE.FrontSide;g.material.opacity=.75;g.material.blendMode=THREE.MultiplyBlending;g.material.transparent=!0;var c=new THREE.Points(new THREE.Geometry);c.material.color=ja[1];c.material.sizeAttenuation=!1;c.material.size=1.5;c.material.fog=!1;scope.stars=c;var f=new THREE.Mesh(new THREE.Geometry,new THREE.MeshBasicMaterial);f.name="Collision Mesh";f.visible=!0;f.material.name="Collision Material";
f.material.side=THREE.BackSide;this.checkpoints=[];var h=new THREE.Vector3(0,0,1),p=new THREE.Vector3(1,0,0);new THREE.Vector3(0,1,0);new THREE.Vector3(0,0,1);var w=new THREE.Vector3(0,3,0),H=new THREE.Vector3(0,0,1),L=q.geometry.clone(),m=n.geometry.clone(),A=x.geometry.clone(),I=E.geometry.clone(),J=[],F=[],ia=new THREE.Vector3;J[0]=new THREE.Vector3(5,3,0);J[1]=new THREE.Vector3(-5,3,0);F[0]=J[0].clone();F.z+=1;F[1]=J[1].clone();F.z+=1;var U=Math.PI/64,W=Math.PI/32,Z=[],qa=0,ma=new THREE.Vector3;
this.start=new THREE.Vector3;var Y=!1,da=!1,na=!1;this.IMPORT=this.END=!1;this.DISTANCE=0;var Xa=18,Ya=new THREE.Raycaster;Ya.far=800;k.geometry.vertices[0]=w.clone();k.geometry.vertices[1]=h.clone().add(w);k.geometry.vertices[2]=J[0].clone();k.geometry.vertices[3]=J[1].clone();k.geometry.vertices[4]=F[0].clone();k.geometry.vertices[5]=F[1].clone();this.connect=function(){scope.SEED=Za;this.BIOME=l=scope.randomInt(0,3);R.SNOW=2===l;R.SNOW&&R.snow.init();oa.add(k);oa.add(q);oa.add(x);oa.add(E);oa.add(n);
oa.add(wireframe);oa.add(g);qa=window.performance.now();window.setTimeout(scope.generate,0)};this.disconnect=function(){for(var u in Z=[],oa.remove(k),oa.remove(q),oa.remove(x),oa.remove(E),oa.remove(n),oa.remove(wireframe),oa.remove(g),oa.remove(y),b)b[u].flag=[];for(var t in scope.checkpoints)oa.remove(scope.checkpoints[t].display),scope.checkpoints[t].display.geometry.dispose(),scope.checkpoints[t].collision.geometry.dispose()};this.complete=function(){f.geometry.mergeVertices();f.geometry.verticesNeedUpdate=
!0;f.geometry.elementsNeedUpdate=!0;f.geometry.computeFaceNormals();f.geometry.computeVertexNormals();f.geometry.computeBoundingSphere();g.geometry.copy(f.geometry);--g.position.z;for(var u=[],t=0;t<f.geometry.faces.length;t++)u[f.geometry.faces[t].a]=f.geometry.faces[t].vertexNormals[0].clone(),u[f.geometry.faces[t].b]=f.geometry.faces[t].vertexNormals[1].clone(),u[f.geometry.faces[t].c]=f.geometry.faces[t].vertexNormals[2].clone();for(t=0;t<f.geometry.vertices.length;t++)f.geometry.vertices[t].add(u[t].multiplyScalar(2));
f.geometry.verticesNeedUpdate=!0;f.geometry.computeFaceNormals();f.geometry.computeVertexNormals();f.geometry.computeBoundingSphere();wireframe.geometry.mergeVertices();wireframe.geometry.verticesNeedUpdate=!0;wireframe.geometry.elementsNeedUpdate=!0;wireframe.geometry.computeFaceNormals();wireframe.geometry.computeBoundingSphere();u=new THREE.IcosahedronGeometry(1200,10);for(var r in u.vertices).3>scope.random()&&-400<u.vertices[r].z&&c.geometry.vertices.push(u.vertices[r].clone());u.dispose();c.geometry.computeBoundingSphere();
R.surface=f.clone();R.start=scope.start.clone();qa=window.performance.now()-qa;Y=!0;scope.END=!0;firebase.analytics().logEvent("stage_generation_complete",{time:Math.round(qa/1E3)});gb?(a.clear(),z.connect(R.start,R.surface),z.PLAY=!1,ya.PLAY=!0):T.ready()};this.reset=function(){Xa=(36+scope.random()-.5)/2;e=0;q.geometry.dispose();x.geometry.dispose();n.geometry.dispose();k.geometry.dispose();E.geometry.dispose();B.geometry.dispose();wireframe.geometry.dispose();f.geometry.dispose();y.geometry.dispose();
c.geometry.dispose();A.dispose();I.dispose();L.dispose();m.dispose();A.copy(new THREE.Geometry);I.copy(new THREE.Geometry);L.copy(new THREE.Geometry);m.copy(new THREE.Geometry);q.geometry.copy(new THREE.Geometry);k.geometry.copy(new THREE.Geometry);x.geometry.copy(new THREE.Geometry);E.geometry.copy(new THREE.Geometry);n.geometry.copy(new THREE.Geometry);B.geometry.copy(new THREE.Geometry);f.geometry.copy(new THREE.Geometry);w.set(0,3,0);H.set(0,0,1);J[0]=new THREE.Vector3(4,3,0);J[1]=new THREE.Vector3(-4,
3,0);Y&&(Y=!1,da=!1,na=!1);this.END=!1;k.position.set(0,0,0);k.geometry.vertices[0]=w.clone();k.geometry.vertices[1]=h.clone().add(w);k.geometry.vertices[2]=J[0].clone();k.geometry.vertices[3]=J[1].clone();k.geometry.vertices[4]=F[0].clone();k.geometry.vertices[5]=F[1].clone();k.geometry.verticesNeedUpdate=!0};this.generate=function(){scope.path()};this.path=function(u,t,r,K,G,C,X,O,Q,P){u=void 0===u?0:u;t=void 0===t?0:t;r=void 0===r?0:r;K=void 0===K?0:K;G=void 0===G?0:G;C=void 0===C?{start:0,end:30,
angle:0,slope:0}:C;X=void 0===X?[]:X;O=void 0===O?[]:O;Q=void 0===Q?!1:Q;P=void 0===P?999:P;var V=window.performance.now(),ba=0;for(0===K&&(K=.5<scope.random()?1:-1);32>ba&&!da;){if(u===C.end+1){O=[];for(r=0;1>r;r++)if(u>=scope.length)O.push({angle:0,slope:0,end:30}),P=u+30;else if(0===t){var ca=scope.randomInt(2,4)*K;ba=Math.floor(Math.abs(36/ca));K=.01>scope.random()?+K:-1*K;ba=scope.randomInt(1,ba);O.push({angle:ca,slope:0,end:ba})}else ca=scope.randomInt(-5,-1),ba=scope.random(),ca=2!==l&&.05>
ba?ca*=-1:ca,ba=scope.randomInt(2,20),O.push({angle:0,slope:ca,end:ba});ba=scope.randomInt(0,O.length);t=O[ba].angle;r=O[ba].slope;C.start=u;C.end=u+O[ba].end;O=O.slice(ba,1)}if(Q||(scope.extrude(t,r),Z.push({angle:t,slope:r}),L.verticesNeedUpdate=!0,u++),10<=u&&!Q){ba=new THREE.Vector2(L.vertices[u-1].x,L.vertices[u-1].y);for(ca=0;ca<L.vertices.length-1-10;ca++)if(18>(new THREE.Vector2(L.vertices[ca].x,L.vertices[ca].y)).distanceTo(ba)){Q=!0;break}Q&&window.setTimeout(R.reset(!0),0)}0;u===P&&(da=
!0,q.geometry.dispose(),q.geometry=L.clone(),q.geometry.computeBoundingSphere(),q.geometry.center(),q.updateMatrixWorld(),0<q.geometry.vertices.length&&(ma.copy(q.geometry.vertices[0]),ma.sub(L.vertices[0])),window.setTimeout(function(){T.PATH=!0;T.STATE();scope["import"]()},0));ba=window.performance.now()-V}da||Q||window.setTimeout(scope.path,0,u,t,r,K,G,C,X,O,Q,P)};this.skijump=function(u,t,r,K,G,C,X,O,Q,P,V){u=void 0===u?0:u;t=void 0===t?0:t;r=void 0===r?0:r;K=void 0===K?0:K;G=void 0===G?0:G;C=
void 0===C?{start:0,end:20,angle:0,slope:0}:C;X=void 0===X?[]:X;O=void 0===O?[]:O;Q=void 0===Q?!1:Q;P=void 0===P?300:P;V=void 0===V?0:V;var ba=window.performance.now(),ca=0;for(0===K&&(K=.5<scope.random()?1:-1);32>ca&&!da;){if(u===C.end+1){O=[];for(t=0;1>t;t++)0===r&&20===C.end?(V=-1,O.push({angle:0,slope:-4,end:30})):3===r?O.push({angle:0,slope:4,end:3}):4===r?O.push({angle:0,slope:-32,end:10}):-4===r?(V=1,O.push({angle:0,slope:r+1,end:1})):-32===r?O.push({angle:0,slope:-4,end:40}):1==V?O.push({angle:0,
slope:r+1,end:1}):-1==V&&O.push({angle:0,slope:r-1,end:1});ca=scope.randomInt(0,O.length);t=O[ca].angle;r=O[ca].slope;C.start=u;C.end=u+O[ca].end;O=O.slice(ca,1)}if(Q||(scope.extrude(t,r),Z.push({angle:t,slope:r}),L.verticesNeedUpdate=!0,u++),10<=u&&!Q){ca=new THREE.Vector2(L.vertices[u-1].x,L.vertices[u-1].y);for(var za=0;za<L.vertices.length-1-10;za++)if(0>(new THREE.Vector2(L.vertices[za].x,L.vertices[za].y)).distanceTo(ca)){Q=!0;break}Q&&window.setTimeout(R.reset(!0),0)}0;P<=u&&(da=!0,q.geometry.dispose(),
q.geometry=L.clone(),q.geometry.computeBoundingSphere(),q.geometry.center(),q.updateMatrixWorld(),0<q.geometry.vertices.length&&(ma.copy(q.geometry.vertices[0]),ma.sub(L.vertices[0])),window.setTimeout(function(){scope["import"]()},0));ca=window.performance.now()-ba}da||Q||window.setTimeout(scope.skijump,0,u,t,r,K,G,C,X,O,Q,P)};this["import"]=function(u){u=void 0===u?0:u;for(var t=window.performance.now(),r=0;!na&&32>r;){if(0===u&&(k.position.set(0,0,0),k.rotation.z=0,w.set(0,3,0),k.geometry.vertices[0]=
w.clone(),k.geometry.vertices[1]=h.clone().add(w),k.geometry.vertices[2]=J[0].clone(),k.geometry.vertices[3]=J[1].clone(),k.geometry.vertices[4]=F[0].clone(),k.geometry.vertices[5]=F[1].clone(),k.geometry.verticesNeedUpdate=!0,k.updateMatrixWorld()),u<Z.length)e=u,angle=Z[u].angle,slope=Z[u].slope,scope.extrude(angle,slope),x.geometry.dispose(),x.geometry=A.clone(),x.geometry.computeBoundingSphere(),E.geometry.dispose(),E.geometry=I.clone(),E.geometry.computeBoundingSphere(),n.geometry.dispose(),
n.geometry=m.clone(),n.geometry.computeBoundingSphere(),u++;else if(!na&&u===Z.length){for(var K in scope.checkpoints=scope.checkpoint(),scope.checkpoints)oa.add(scope.checkpoints[K].display);na=!0;window.setTimeout(function(){scope.terrain(!0)},0)}r=window.performance.now()-t}na||window.setTimeout(scope["import"],0,u,angle,slope)};this.extrude=function(u,t){u=void 0===u?0:u;t=void 0===t?0:t;for(var r in k.updateMatrixWorld(),k.rotateZ(u*W),k.geometry.vertices)k.geometry.vertices[r].applyAxisAngle(p,
t*U);k.geometry.verticesNeedUpdate=!0;r=k.geometry.vertices[0].clone();var K=k.geometry.vertices[2].clone(),G=k.geometry.vertices[3].clone(),C=k.geometry.vertices[1].clone();if(r.applyMatrix4(k.matrix),K.applyMatrix4(k.matrix),G.applyMatrix4(k.matrix),C.applyMatrix4(k.matrix),C.sub(r),da){if(K.add(ma),G.add(ma),0<A.vertices.length){var X=A.vertices[A.vertices.length-1].clone().sub(ia),O=A.vertices[A.vertices.length-2].clone().sub(ia);m.vertices.push(K.clone().sub(C));m.vertices.push(G.clone().sub(C));
m.vertices.push(O);m.vertices.push(G.clone().sub(C));m.vertices.push(X);m.vertices.push(O);var Q=K.clone();u=G.clone();X=A.vertices[A.vertices.length-1].clone();O=A.vertices[A.vertices.length-2].clone();f.geometry.vertices.push(Q);f.geometry.vertices.push(u);f.geometry.vertices.push(O);f.geometry.vertices.push(u);f.geometry.vertices.push(X);f.geometry.vertices.push(O);X=m.vertices.length;var P=new THREE.Face3(X-3,X-2,X-1);Q=new THREE.Face3(X-5,X-4,X-6);m.faces.push(P);m.faces.push(Q);P=P.clone();
Q=Q.clone();P.color=new THREE.Color(16777215);Q.color=new THREE.Color(16777215);f.geometry.faces.push(P);f.geometry.faces.push(Q)}0<I.vertices.length?(P=2,Q=1,4<I.vertices.length&&(P=4,Q=2),P=I.vertices[I.vertices.length-P].clone(),Q=I.vertices[I.vertices.length-Q].clone(),I.vertices.push(K.clone().add(C)),I.vertices.push(P.clone()),I.vertices.push(G.clone().add(C)),I.vertices.push(Q.clone()),e==Z.length-1&&(O=K.clone().add(C),X=G.clone().add(C),I.vertices.push(O),I.vertices.push(X))):(I.vertices.push(K.clone().add(C)),
I.vertices.push(G.clone().add(C)));A.vertices.push(K.clone());A.vertices.push(G.clone());ia.copy(C)}else L.vertices.push(r.clone());for(var V in w.copy(r).sub(k.position),k.position.add(w),k.geometry.vertices)k.geometry.vertices[V].applyAxisAngle(p,-1*t*U)};this.terrain=function(u,t,r,K,G,C,X){t=void 0===t?[]:t;r=void 0===r?[]:r;K=void 0===K?[]:K;G=void 0===G?0:G;C=void 0===C?0:C;X=void 0===X?0:X;if(void 0===u||u){x.updateMatrixWorld();B.geometry.dispose();B.geometry.copy(new THREE.Geometry);t=[];
r=[];K=[];for(u=0;2>u;u++)K[u]=[],t[u]=[],r[u]=[];for(u=0;u<x.geometry.vertices.length;u++)r[u%2].push(x.geometry.vertices[u]);for(u=0;2>u;u++)for(var O=0;O<r[u].length;O++){var Q=0===u?1:-1,P=r[u][O].clone();P.sub(r[u+Q][O]);P.normalize().multiplyScalar(3);K[u][O]=P.clone()}}O=0;var V;u=window.performance.now();if(4>G){if(B.geometry.verticesNeedUpdate=!0,B.geometry.elementsNeedUpdate=!0,B.geometry.computeBoundingSphere(),B.geometry.computeFaceNormals(),B.geometry.computeVertexNormals(),B.updateMatrixWorld(),
0<G&&0===X)for(r[C]=[],Q=0;Q<t[C].length;Q++)r[C][Q]=B.geometry.vertices[t[C][Q]];0===X&&(t[C]=[]);for(v=X;v<r[C].length&&32>O;){O=!1;if(void 0!==r[C][v]&&void 0!==r[C][v-1]){if(void 0===K[C][v])K[C][v]=K[s][v-1].clone();else if(B.geometry.computeBoundingSphere(),Q=r[C][v].clone().add(K[C][v]),Q.z-=100,Ya.set(Q,h),Q.z+=100,P=Ya.intersectObjects([B],!0),0<P.length)for(var ba in P).01<P[ba].point.distanceTo(Q)&&(t[C][v]=void 0,O=!0);O||(B.geometry.vertices.push(r[C][v].clone()),B.geometry.vertices.push(r[C][v].clone().add(K[C][v])),
t[C][v]=B.geometry.vertices.length-1,0<v&&(B.geometry.vertices.push(r[C][v-1].clone()),V=B.geometry.vertices.length,0===C?B.geometry.faces.push(new THREE.Face3(V-2,V-1,V-3)):1===C&&B.geometry.faces.push(new THREE.Face3(V-1,V-2,V-3))))}O=window.performance.now()-u;v++;X=v}if(X===r[C].length){X=0;for(V=1;V<t[C].length;V++)if(void 0!==t[C][V]&&void 0!==t[C][V-1]){ba=B.geometry.vertices[t[C][V]];var ca;u=B.geometry.vertices[t[C][V-1]];2.8>ba.distanceTo(u)?(ba.copy(u),t[C][V]=t[C][V-1],K[C][V].copy(K[C][V-
1])):1<V&&(B.geometry.vertices.push(r[C][V-1]),ca=0===C?t[C][V]:t[C][V-1],u=0===C?t[C][V-1]:t[C][V],B.geometry.faces.push(new THREE.Face3(ca,u,B.geometry.vertices.length-1)))}C++}1<C&&(C=0,G++)}if(4===G){B.geometry.verticesNeedUpdate=!0;B.geometry.elementsNeedUpdate=!0;B.geometry.colorsNeedUpdate=!0;B.geometry.computeFaceNormals();B.geometry.computeVertexNormals();B.geometry.mergeVertices();B.geometry.computeBoundingSphere();scope.noise(B.geometry);for(ca=0;ca<B.geometry.faces.length;ca++)ba=B.geometry.vertices[B.geometry.faces[ca].a].clone(),
u=B.geometry.vertices[B.geometry.faces[ca].b].clone(),V=B.geometry.vertices[B.geometry.faces[ca].c].clone(),B.geometry.colors[B.geometry.faces[ca].a],B.geometry.colors[B.geometry.faces[ca].b],B.geometry.colors[B.geometry.faces[ca].c],f.geometry.vertices.push(ba),f.geometry.vertices.push(u),f.geometry.vertices.push(V),wireframe.geometry.vertices.push(ba),wireframe.geometry.vertices.push(u),wireframe.geometry.vertices.push(V),V=f.geometry.vertices.length,ba=new THREE.Face3(V-1,V-2,V-3),ba.color=new THREE.Color(0),
f.geometry.faces.push(ba),wireframe.geometry.faces.push(new THREE.Face3(V-1,V-2,V-3));wireframe.geometry.copy(B.geometry);wireframe.geometry.computeVertexNormals();scope.biome();window.setTimeout(scope.complete,0)}else window.setTimeout(function(){scope.terrain(!1,t.slice(),r.slice(),K.slice(),G,C,X)},0)};this.biome=function(){for(var u=l,t=wireframe.geometry.faces,r=[],K=[],G=0;G<t.length;G++)for(var C=0;C<b[l].map.length;C++)t[G].vertexColors[0]=b[l].map[C](t[G].vertexNormals[0].z,t[G].a),t[G].vertexColors[1]=
b[l].map[C](t[G].vertexNormals[1].z,t[G].b),t[G].vertexColors[2]=b[l].map[C](t[G].vertexNormals[2].z,t[G].c);for(t=0;t<b[l].flags.length;t++)for(G=0;G<x.geometry.vertices.length;G++).1>wireframe.geometry.vertices[t].distanceTo(x.geometry.vertices[G])&&(b[l].flags[t]=!1);for(t=0;t<b[l].flags.length;t++)b[l].flags[t]&&r.push(t);for(t=0;t<b[l].limit&&t<r.length;){G=scope.randomInt(0,r.length);C=!0;if(0<K.length&&0<r.length)for(;C;){for(var X in K){if(wireframe.geometry.vertices[r[G]].distanceTo(wireframe.geometry.vertices[K[X]])<
b[l].range){C=!0;r.slice(G,1);G=scope.randomInt(0,r.length);break}C=!1}0>=r.length&&(C=!1)}if(0<r.length){C=b[u].tree();for(var O in C.vertices)y.geometry.vertices.push(C.vertices[O].clone().add(wireframe.geometry.vertices[r[G]])),y.geometry.colors[y.geometry.vertices.length-1]=C.colors[O];K.push(r[G]);r.slice(G,1)}t++}y.verticesNeedUpdate=!0;y.elementsNeedUpdate=!0;oa.add(y)};this.sakura=function(){var u=new THREE.Geometry,t=[],r=[],K=1,G,C=new THREE.Vector3(0,0,0),X=new THREE.Vector3(0,0,3),O=12,
Q=0,P=new THREE.Vector3(1,0,0),V=new THREE.Vector3(0,0,1);u.vertices.push(C);u.vertices.push(X);u.colors.push(ja[2]);u.colors.push(ja[2]);r.push({v:X.clone(),n:X.clone(),pitch:P.clone(),roll:V.clone()});for(C=[];4>Q;){X=[];for(P=0;P<r.length;P++)for(var ba=V=0;3>ba;ba++){var ca=0===Q&&2===ba&&1>V?1:scope.random();if(.2<ca){ca=scope.randomInt(-2,2);var za=r[P].n.clone(),Ia=ja[2];za.applyAxisAngle(r[P].pitch,2*Math.PI/(O+ca));za.applyAxisAngle(r[P].roll,2*Math.PI/3*ba);za.multiplyScalar(K);ca=za.clone().add(r[P].v);
u.vertices.push(r[P].v.clone());u.vertices.push(ca);u.colors.push(Ia);u.colors.push(Ia);Ia=r[P].pitch.clone();Ia.applyAxisAngle(r[P].roll,2*Math.PI/3*ba);Ia.applyAxisAngle(r[P].pitch,2*Math.PI/O);var wa=r[P].roll.clone();wa.applyAxisAngle(r[P].pitch,2*Math.PI/O);wa.applyAxisAngle(r[P].roll,2*Math.PI/3*ba);0<ba&&t.push({a:ca.clone(),b:r[P].v.clone(),pitch:Ia,roll:wa});X.push({v:ca.clone(),n:za.clone(),pitch:Ia,roll:wa});V++}else 0===V&&2===ba&&C.push({v:r[P].v.clone(),n:r[P].n.clone(),pitch:r[P].pitch.clone(),
roll:r[P].roll.clone()})}r=X.slice();K*=.9;Q++}for(G in O=6,t)K=t[G].a.clone(),X=t[G].b.clone(),K=K.clone().sub(X),P=K.clone().multiplyScalar(.5).add(X),Q=scope.randomInt(0,3)-1,K.applyAxisAngle(t[G].pitch,2*Math.PI/O),K.applyAxisAngle(t[G].roll,2*Math.PI/Q),K.multiplyScalar(.5),X=P,P=K.clone().add(P),u.vertices.push(X),u.vertices.push(P),u.colors.push(ja[2]),u.colors.push(ja[2]),X=t[G].pitch.clone(),X.applyAxisAngle(t[G].roll,2*Math.PI/Q),X.applyAxisAngle(t[G].pitch,2*Math.PI/O),V=t[G].roll.clone(),
V.applyAxisAngle(t[G].pitch,2*Math.PI/O),V.applyAxisAngle(t[G].roll,2*Math.PI/Q),r.push({v:P.clone(),n:K.clone(),pitch:X,roll:V});r=r.concat(C);for(t=0;t<r.length;t++)for(G=0;5>G;G++)O=r[t].n.clone(),O.normalize(),O.applyAxisAngle(r[t].pitch,2*Math.PI/6),O.applyAxisAngle(r[t].roll,2*Math.PI/5*G),O.multiplyScalar(.5),O=O.add(r[t].v),C=r[t].v.clone(),u.vertices.push(O),u.vertices.push(C),u.colors.push(ja[12]),u.colors.push(ja[12]);return u.colorsNeedUpdate=!0,u};this.pine=function(){var u=Math.floor(8*
scope.random())+6,t=2*Math.PI/6,r=new THREE.Geometry;r.vertices.push(new THREE.Vector3(0,0,0));r.vertices.push(new THREE.Vector3(0,0,+u-.5+1));r.colors.push(ja[9]);r.colors.push(ja[9]);r.colors.push(ja[9]);for(var K=1;K<u;K++)for(var G=0;6>G;G++)off=K%2*t*.5,r.vertices.push(new THREE.Vector3(0,0,+K+1)),r.vertices.push(new THREE.Vector3(.3*(u-K),0,+K-.3+1)),r.vertices[r.vertices.length-1].applyAxisAngle(h,t*G+off),r.colors.push(ja[9]),r.colors.push(ja[9]);return r};this.checkpoint=function(){function u(G,
C,X){var O=new THREE.Geometry,Q=(new THREE.Vector3).copy(G).sub(C),P=(new THREE.Vector3).copy(G).add(Q.clone().multiplyScalar(1.5));Q=(new THREE.Vector3).copy(C).sub(Q.clone().multiplyScalar(1.5));O.vertices.push(new THREE.Vector3(P.x,P.y,P.z-12));O.vertices.push(new THREE.Vector3(P.x,P.y,P.z+12));O.vertices.push(new THREE.Vector3(Q.x,Q.y,Q.z+12));O.vertices.push(new THREE.Vector3(Q.x,Q.y,Q.z+12));O.vertices.push(new THREE.Vector3(Q.x,Q.y,Q.z-12));O.vertices.push(new THREE.Vector3(P.x,P.y,P.z-12));
O.faces.push(new THREE.Face3(0,1,2));O.faces.push(new THREE.Face3(3,4,5));P=new THREE.Geometry;P.vertices.push(new THREE.Vector3(G.x,G.y,G.z+6));P.vertices.push(new THREE.Vector3(G.x,G.y,G.z+8));P.vertices.push(new THREE.Vector3(C.x,C.y,C.z+6));P.vertices.push(new THREE.Vector3(C.x,C.y,C.z+8));P.vertices.push(new THREE.Vector3(G.x,G.y,G.z+6));P.vertices.push(new THREE.Vector3(C.x,C.y,C.z+6));P.vertices.push(new THREE.Vector3(G.x,G.y,G.z+8));P.vertices.push(new THREE.Vector3(C.x,C.y,C.z+8));P.vertices.push(new THREE.Vector3(G.x,
G.y,G.z+1));P.vertices.push(new THREE.Vector3(C.x,C.y,C.z+1));G=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,wireframe:!1,fog:!0});G.color=ja[5];O=new THREE.Mesh(O,G);O.visible=!0;G=new THREE.LineSegments(P,G);return O.name="Objective "+X,G.name="Checkpoint"+X,{display:G,collision:O}}var t=x.geometry,r=t.vertices.length-80;r=Math.floor(r/4)-Math.floor(r/4)%2;var K=[];K[0]=u(t.vertices[40],t.vertices[41],0);K[1]=u(t.vertices[40+r],t.vertices[1+r+40],1);K[2]=u(t.vertices[2*r+40],t.vertices[2*
r+41],2);K[3]=u(t.vertices[3*r+40],t.vertices[3*r+41],3);K[4]=u(t.vertices[4*r+40],t.vertices[4*r+41],4);this.DISTANCE=4*r/2*3;scope.start.copy(t.vertices[36]);scope.start.sub(t.vertices[37]);scope.start.multiplyScalar(-.75);scope.start.add(t.vertices[36]);for(t=0;5>t;t++)null==R.best&&(R.best[t]=4>t?r*(t+1)/Xa:R.best[t]=R.best[t-1]);return T.STATE(),K};this.resetCheckpoints=function(){for(var u in scope.checkpoints)scope.checkpoints[u].display.material.color=ja[5]};this.random=function(){Za=(Za+
1)%2147483647;var u=1E4*Math.sin(Za);return u-Math.floor(u)};this.randomInt=function(u,t){return Math.floor(scope.random()*(t-u))+u};this.noise=function(u){var t=new ub,r=[],K=8,G=0,C=0,X=1E3*scope.random();l;for(var O=0;O<u.vertices.length;O++)r[O]=0;for(O=0;2>O;O++){for(var Q=0;Q<u.vertices.length;Q++)r[Q]+=Math.floor(t.noise(u.vertices[Q].x/K,u.vertices[Q].y/K,X)*K),r[Q]>G&&(G=r[Q]),r[Q]<C&&(C=r[Q]);K*=3}for(t=0;t<r.length;t++){K=2===l?2:.5;for(G=0;G<x.geometry.vertices.length;G++)C=u.vertices[t].distanceTo(x.geometry.vertices[G]),
C=C*C/100,C<K&&(K=C);u.vertices[t].z+=r[t]*K}};this.name=function(){var u="";if(bb)u=T.custom_seed;else if(Oa||gb)u=T.CHALLENGES.seed;else{var t=[" forest"," pass"," mountain"],r="wa tsu mi n wa ra ya ma ha na ta ka a wi ri mi hi ni chi shi ki i ru yu mu fu nu tsu su ku u we re me he ne te se ke e wo ro yo mo no to so ko o".split(" ");TOGGLE=!1;for(var K=Math.ceil(3*Math.random())+1,G=0;G<K;)u+=r[Math.floor(Math.random()*r.length)],G++;r=2===l?1:0;r=t[Math.floor(r+Math.random()*(t.length-r))];u+=
r;(.04<Math.random()||u!==kb)&&(u="",r=Math.floor(Math.random()*lb.length),u=lb[r])}return kb=u,this.BIOME=l,u}}function aa(){hb=!0;window.removeEventListener("touchstart",aa)}function ha(){var e=1===window.devicePixelRatio&&600<=window.innerWidth&&600<=window.innerHeight?2:1,b=window.innerWidth,l=window.innerHeight;ka.aspect=b/l;ka.updateProjectionMatrix();a.resize(b,l,e,La);T.resize(b,l,e)}function ta(){if(window.requestAnimationFrame(ta),cb=window.performance.now(),!Ca||z.IMPORT||Fa)if(z.REPLAY&&
!Ca){mb();R.update();z.update();uas.update(z.TIMESTAMP);Fa&&0<fa.length&&z.TIMESTAMP>10*fa[0].cp[4]+5E3&&z.reset(!0);!va&&0<z.TIMESTAMP&&!nb&&ob;for(var e=0;e<fa.length;e++)fa[e].update(z.TIMESTAMP-0,z.FRAME)}else if($a||ya.SCAN&&!Ca)ka.up.set(0,0,1),ka.position.applyAxisAngle(ka.up,.01),ka.lookAt(new THREE.Vector3),$a&&T.loading(),T.scanning();else{if(Fa||z.IMPORT){for(e="";e.length<Math.floor(cb/500)%4;)e+=".";a.clear();a.text("importing ghost data"+e,16,16);R.update()}ka.up.set(0,0,1);ka.position.applyAxisAngle(ka.up,
.01);ka.lookAt(new THREE.Vector3,0,0,0)}else{z.update();for(e=0;e<fa.length;e++)z.START?fa[e].update(z.TIMESTAMP,z.FRAME):fa[e].update(0,0);uas.update(z.TIMESTAMP);va||ib||T.update();!hb||va||Ua||a.dpad();M.RESET&&!va&&(T.reset(),M.RESET=!1);R.update()}Ga.render(oa,ka);a.update(M.touches)}function Ka(){var e=this;this.SNOW=this.COMPLETE=!1;this.start=new THREE.Vector3;this.generate=new S;this.checkpoint=[];this.objectives=[];this.best=[];this.grid=[];this.dimension=2400;this.partitionDimension=16;
this.partionDivision=this.dimension/this.partitionDimension;this.seed;this.snow={distance:200,height:100,limit:200,mesh:new THREE.Points(new THREE.Geometry,new THREE.PointsMaterial),init:function(){for(;e.snow.mesh.geometry.vertices.length<e.snow.limit;){var l=new THREE.Vector3;l.copy(ka.position);l.x+=Math.random()*e.snow.distance-e.snow.distance/2;l.y+=Math.random()*e.snow.distance-e.snow.distance/2;l.z+=Math.random()*e.snow.height-e.snow.height/2;e.snow.mesh.geometry.vertices.push(l)}e.snow.mesh.geometry.verticesNeedUpdate=
!0;e.snow.mesh.geometry.computeBoundingSphere()},update:function(){for(var l=0;l<e.snow.mesh.geometry.vertices.length;l++){var k=e.snow.mesh.geometry.vertices[l];k.z-=.5*z.DT();(Math.abs(k.z-ka.position.z)>e.snow.height/2||Math.abs(k.x-ka.position.x)>e.snow.distance/2||Math.abs(k.y-ka.position.y)>e.snow.distance/2)&&(k.copy(ka.position),k.x+=Math.random()*e.snow.distance-e.snow.distance/2,k.y+=Math.random()*e.snow.distance-e.snow.distance/2,k.z+=Math.random()*e.snow.height-e.snow.height/2)}e.snow.mesh.geometry.verticesNeedUpdate=
!0;e.snow.mesh.geometry.computeBoundingSphere()}};for(var b=0;4>b;b++)this.checkpoint[this.checkpoint.length]=new THREE.Mesh(new THREE.Geometry);this.connect=function(l){l=void 0===l?!1:l;if(ka.position.set(0,400,200),ka.far=2E3,ka.updateProjectionMatrix(),ka.lookAt(new THREE.Vector3),Ga.render(oa,ka),!l){this.name=this.generate.name();l="";for(var k in this.name)l+=this.name.charCodeAt(k).toString();Za=l}e.generate.connect();vb++};this.disconnect=function(){this.generate.disconnect();this.generate.reset()};
this.reset=function(l){l=void 0===l?!1:l;Za++;e.best=[];e.COMPLETE=!1;e.disconnect();e.generate=new S;e.connect(l)};this.preview=function(){window.setTimeout(0,0)};this.update=function(){this.SNOW&&this.snow.update()}}function Qa(){function e(){var g;return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){if(1==c.nextAddress)return b.paymentRedirect(),c.yield(firebase.firestore().collection("boost").doc(la).collection("checkout_sessions").add({price:"price_1JA2mVDOOVUBaO92ymRKRqD7",success_url:window.location.origin,
cancel_url:window.location.origin}),2);g=c.yieldResult;g.onSnapshot(function(f){(f=f.data().sessionId)&&Stripe("pk_test_51J8G7CDOOVUBaO92w6Lvt6dfGNpR1xZoXnnGuCZuxkAT36g72UtR8hnNe2mOMn83hgTwZKK2T9w8MeigJpffOy2600U5nLR4e9").redirectToCheckout({sessionId:f})});c.jumpToEnd()})}var b=this,l,k,q=0,x=0,n=[];n.push(function(){a.style=0;a.link("","0","1.0-24","1.0-4","6","https://ginko.ltd");a.renderer.className="promo_a";a.print("support development by","2","1.0-23");a.style=6;a.print("acquiring items from ginko.ltd!",
"2","1.0-21")});n.push(function(){a.style=0;a.renderer.className="promo_b";a.print("new mixtape by","2","1.0-23");a.style=1;a.print("low recordings! listen now!","2","1.0-21");a.button("","2","1.0-22","40","7",function(){var g=document.getElementById("mp3_player");g.currentTime=Math.random()*g.duration;g.play();b.STATE();db=!0;b.menu(b.intro)},!1)});this.custom_seed="";var E="#1#ffffff#334#",B=(Ma,0),y=!0;this.SETTINGS=!1;this.STATE=function(){b.intro()};this.CHALLENGES={};this.CHALLENGER="";this.TIMELIST=
[];this.BATTLE=[];this.PATH=!1;this.login=function(){firebase.auth().onAuthStateChanged(function(g){return g?(la=g.uid,g=firebase.auth().currentUser.email,b.cancelRecovery(),b.requestBoost(),null!==g&&(Va=!0),b.STATE(),ya.requestName(la,function(c){pa=c;b.STATE()})):(la=!1,T.validateRecovery(),T.requestBoost(),b.STATE()),null})};this.exit=function(g){a.sprite(16,64,8,8,"1.0-4+2p","2",8,8);a.button("","1.0-7","2+4p","7","5",function(){y||a.backdrop(!1);g();va=!1;b.SETTINGS=!1},!1)};this.register=function(g){a.clear();
b.STATE=function(){b.register(g)};ib=!0;b.inputName(function(){ib=!1;ya["export"]()},!0,"input name to save data")};this.logout=function(g,c,f){c=void 0===c?Va:c;(void 0===f?0:f)?(a.clear(),firebase.auth().signOut().then(function(){location.reload()})["catch"](function(h){})):c?(a.clear(),b.exit(g),a.print("log out of current session?","2","2"),a.sprite(0,0,1,1,"2","6","1.0-4",1),a.print("> confirm","2","8"),a.button("","2","8+4p","1.0-4","4",function(){b.logout(g,!0,!0)},!1),a.sprite(0,0,1,1,"2",
"11","1.0-4",1),a.print("> cancel","2","13"),a.button("","2","13+4p","1.0-4","4",function(){g()},!1),a.sprite(0,0,1,1,"2","16","1.0-4",1)):(a.clear(),b.exit(g),a.print("account recovery not set.","2","2"),a.print("you will be unable to log back in.","2","4"),a.sprite(0,0,1,1,"2","9","1.0-4",1),a.print("> set account recovery","2","11"),a.button("","2","11+4p","1.0-4","4",function(){b.updateRecovery(g,"add recovery email:","cancel")},!1),a.sprite(0,0,1,1,"2","14","1.0-4",1),a.print("> continue to logout",
"2","16"),a.button("","2","16+4p","1.0-4","4",function(){b.logout(g,!0)},!1),a.sprite(0,0,1,1,"2","19","1.0-4",1))};this.cancelRecovery=function(){firebase.auth().isSignInWithEmailLink(window.location.href)&&(b.STATE=function(){b.cancelRecovery()},a.clear(),a.backdrop(!1),b.exit(b.intro),a.print("account recovery failed.","2","2"),a.print("logout before signing into a new account","2","4"),a.button("","2","4+4p","6","2",function(){b.logout(b.intro)},!1),a.sprite(0,0,1,1,"2","5+4p","6",1),console.log("cancel recovery"))};
this.validateRecovery=function(g,c){c=void 0===c?window.localStorage.getItem("email"):c;var f=!1;return firebase.auth().isSignInWithEmailLink(window.location.href)&&(f=!0,console.log("validate log-in"),console.log("local email",c),c?firebase.auth().signInWithEmailLink(c,window.location.href).then(function(h){window.localStorage.removeItem("email");window.history.pushState("","","/");b.intro();console.log(h.user.uid);console.log(la);null===la&&!1===la||g.cancelRecovery(g)})["catch"](function(h){b.invalidRecovery();
window.history.pushState("","","/")}):(console.log("validate email"),b.validateEmail(g))),f};this.invalidRecovery=function(){a.clear();a.print("invalid or expired login link..","2","2");window.setTimeout(b.intro,2E3)};this.validateEmail=function(g,c,f){c=void 0===c?"verify account recovery email":c;f=void 0===f?"cancel":f;b.STATE=function(){b.validateEmail(g,c,f)};a.clear();b.exit(g);a.print(c,"2","2");a.textinput("","2","4","1.0-2","6","recovery");var h=document.getElementById("recovery");a.button("accept",
"2","14","1.0-4","6",function(){a.clear();a.print("validating recovery email...","2","2");b.validateRecovery(g,h.value)})};this.updateRecovery=function(g,c,f){c=void 0===c?"update account recovery email":c;f=void 0===f?"cancel":f;a.clear();b.exit(g);var h=Va?firebase.auth().currentUser.email:"";a.print(c,"2","2");a.textinput(h,"2","4","1.0-2","6","recovery");var p=document.getElementById("recovery");a.style=2;c=f.length+4;a.button(f,"1.0-"+c,"20",""+c,"4",function(){g()},!1);a.style=0;a.button("accept",
"2","14","1.0-4","6",function(){b.submitRecovery(g,h,p.value,Va)})};this.submitRecovery=function(g,c,f,h,p){(void 0===h?0:h)?this.confirmMenu("update account recovery email to "+f,function(){b.submitRecovery(g,c,f,!1,p)},g):(a.clear(),a.print("updating recovery email...","2","2"),firebase.auth().currentUser.updateEmail(f).then(function(){console.log("email updated");Va=!0;a.clear();a.print("recovery email updated to "+firebase.auth().currentUser.email,"2","2");window.setTimeout(g,2E3)})["catch"](function(w){var H=
w.code;w.message;errorState=[];errorState["auth/requires-recent-login"]=function(){a.clear();a.print("error: account requires recent login","2","2");a.print("sending login link to "+firebase.auth().currentUser.email,"2","4");b.recovery(firebase.auth().currentUser.email)};errorState["auth/email-already-in-use"]=function(){a.clear();a.print("error: account recovery email address in use","2","2");window.setTimeout(function(){b.updateRecovery(g)},2E3)};errorState["auth/invalid-email"]=function(){a.clear();
a.print("error: invalid email","2","2");window.setTimeout(function(){b.updateRecovery(g)},2E3)};errorState[H]()}))};this.requestRecovery=function(g){var c=this;b.STATE=function(){c.requestRecovery(g)};a.clear();b.exit(g);a.print("request login link using account recovery email","2","2");a.textinput("","2","4","1.0-2","6","recovery");var f=document.getElementById("recovery");a.button("accept","2","14","1.0-4","6",function(){b.recovery(f.value)})};this.mergeRecovery=function(g,c){c=firebase.auth.EmailAuthProvider.credentialWithLink(c,
window.location.href);firebase.auth().currentUser.linkWithCredential(c).then(function(f){console.log("account merged.")})["catch"](function(f){})};this.recovery=function(g){var c=this;a.clear();a.print("sending login link to "+g+"...","2","2");firebase.auth().sendSignInLinkToEmail(g,{url:"http://localhost:8000/dev/",handleCodeInApp:!0}).then(function(){a.clear();T.exit(c.intro);a.print("login link sent to "+g,"2","2");window.localStorage.setItem("email",g)})["catch"](function(f){var h=f.code;f=f.message;
console.log(h,f)})};this.requestBoost=function(){!1!==la&&null!==la&&firebase.firestore().collection("boost").doc(la).collection("subscriptions").where("status","in",["trialing","active"]).onSnapshot(function(g){return $jscomp.asyncExecutePromiseGeneratorProgram(function(c){Aa=g.docs.length;0<Aa&&g.docs[0];b.STATE();c.jumpToEnd()})})};this.paymentRedirect=function(){b.STATE=function(){b.paymentRedirect};a.clear();a.print("redirecting to stripe...","2","2")};this.resize=function(g,c){l=a.width;k=a.height;
Ja=Math.floor((window.innerHeight/a.scale/a.row-34)/2)};this.wallet=function(){null===la&&!1===la||(!1===Aa||0===Aa?(a.style=7,a.print("activate adv +","2","1.0-4")):(a.style=7,a.print("adv + lvl "+Aa,"2","1.0-4")),a.button("","0","1.0-4+4p","18","4",b.boost,!1),a.style=0)};this.nav=function(g){g=void 0===g?function(){a.clear()}:g;a.style=0;a.sprite(8,64,8,8,"1.0-4+2p","2",8,8);a.button("","2","2+4p","1.0-4","8",function(){b.menu(g)},!1)};this.title=function(g,c,f){a.style=0;b.breadcrumb(g,c,f);b.exit(c);
db?(a.style=1,a.sprite(40,72,8,10,"1.0-14","2",8,10),a.sprite(48,72,16,16,"1.0-19","2",16,16),a.sprite(16,72,16,16,"1.0-10","2",16,16),a.style=0,a.button("","1.0-23","2+4p","7","5",function(){var h=document.getElementById("mp3_player");h.currentTime=Math.random()*h.duration;h.play();b.STATE()},!1),a.button("","1.0-14","2+4p","7","5",function(){document.getElementById("mp3_player").pause();db=!1;b.STATE()},!1)):(a.style=4,a.sprite(16,72,16,16,"1.0-10","2",16,16),a.style=0,a.button("","1.0-14","2+4p",
"7","5",function(){document.getElementById("mp3_player").play();db=!0;b.STATE()},!1));b.wallet()};this.breadcrumb=function(g,c,f){var h=void 0===f?function(){y||a.backdrop(!1);c();va=!1;b.SETTINGS=!1}:function(){f(c);va=!0};a.style=db?1:0;a.style=0;a.print(void 0===g?"menu":g,"4","2");a.style=0;a.print("<","2","2");a.button("","2","2+4p","7","8",h,!1)};this.menu=function(g){va=!0;a.style=0;b.STATE=function(){b.menu(g)};y||a.backdrop();a.clear();b.title("menu",g,g);a.sprite(0,0,1,1,"2","6","1.0-4",
1);Fa?(a.print(" > view spectator controls","2","8"),a.button("","2","8+4p","1.0-4","5",function(){b.uas(!0)},!1)):(a.print(" > modify vehicle","2","8"),a.button("","2","8+4p","1.0-4","5",function(){b.vehicle(g)},!1));a.sprite(0,0,1,1,"2","11","1.0-4",1);a.print(" > settings","2","13");a.button("","2","13+4p","1.0-4","5",function(){b.settings(g)},!1);a.sprite(0,0,1,1,"2","16","1.0-4",1);var c=8,f;Fa?(f=uas.AUTOPILOT?"disable":"enable",a.button(f+" autopilot","2","1.0-2-"+c,"1.0-4","6",function(){a.backdrop(!1);
uas.AUTOPILOT=!uas.AUTOPILOT;b.replay()},!0),c+=8,a.button("deploy vehicle","2","1.0-2-"+c,"1.0-4","6",function(){a.backdrop(!1);Fa=!1;b.STATE=function(){};z.reset(!1);b.reset();Ca=!0;z.START=!1;z.disconnect();z.connect(R.start,R.surface,!1);b.play()},!0)):(Ca||z.REPLAY)&&(a.button("restart stage","2","1.0-2-"+c,"1.0-4","6",function(){a.backdrop(!1);b.reset()},!0),c+=8,a.button("next stage","2","1.0-2-"+c,"1.0-4","6",function(){a.backdrop(!1);b.next()},!0));b.discord();b.wallet()};this.boost=function(g,
c){e()};this.account=function(g){a.clear();this.STATE=function(){b.account(g)};b.title("account",function(){g()},function(){return b.menu(g)});var c=6;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);c+=2;a.print("display name","2",""+c);"string"==typeof pa&&0<pa.length?a.print(pa,"1.0-2-"+pa.length,""+c):(a.style=4,a.print("missing","1.0-9",""+c),a.style=0);a.button("","2",c+1+"+4p","1.0-4","4",function(){b.inputName(function(){b.account(g)},!1)},!1);c+=3;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);!1!==la&&null!==
la&&(c+=2,a.print("account recovery","2",""+c),Va?(a.style=1,a.print("saved","1.0-7",""+c)):(a.style=4,a.print("missing","1.0-9",""+c)),a.style=0,a.button("","2",c+1+"+4p","1.0-4","4",function(){b.updateRecovery(function(){b.account(g)})},!1),c+=3,a.sprite(0,0,1,1,"2",""+c,"1.0-4",1));0<Aa&&(c+=2,a.print("billing","2",""+c),a.print("[edit]","1.0-8",""+c),a.button("","2",c+1+"+4p","1.0-4","4",function(){b.paymentRedirect();(function(){var f,h,p;return $jscomp.asyncExecutePromiseGeneratorProgram(function(w){if(1==
w.nextAddress)return f=firebase.app().functions("us-central1").httpsCallable("ext-firestore-stripe-subscriptions-createPortalLink"),w.yield(f({returnUrl:window.location.origin}),2);h=w.yieldResult;p=h.data;window.location.assign(p.url);w.jumpToEnd()})})()},!1),c+=3,a.sprite(0,0,1,1,"2",""+c,"1.0-4",1));c+=2;!1!==la&&null!==la&&(a.print("logout","2",""+c),a.button("","2",c+1+"+4p","1.0-4","4",function(){b.logout(g)},!1),c+=3,a.sprite(0,0,1,1,"2",""+c,"1.0-4",1))};this.intro=function(){var g,c;b.STATE=
function(){b.intro()};y=!0;a.clear();a.print("specialstage.io","2","2");a.print("-","2","4");Oa?(a.style=4,a.print("challenge detected!","2","12"),a.style=0,g=null!==b.CHALLENGER&&0<b.CHALLENGER.length?b.CHALLENGER:"...",a.style=2,a.print("rival:","2","15"),a.style=0,a.print(g,"9","15"),ya.requestName(b.CHALLENGES.uid,function(f){b.CHALLENGER=f;b.STATE()}),a.style=2,a.print("seed:","2","17"),a.style=0,a.print(b.CHALLENGES.seed,"9","17")):bb&&(g=!(a.style=3)===la||null===la?"15":"13",a.print("seed detected",
"2",g,1),a.style=0,a.print("> "+b.custom_seed,"2",g+"+3",1));(null===la||!1!==la||"string"==typeof la&&!1===Aa)&&""===pa?(a.style=2,a.print("> loading user data...","2","6"),a.style=0):null!==pa&&""!==pa?(a.style=5,a.print("welcome back!","2","6"),a.style=0,a.print("> ","2","9"),a.style=0<Aa?7:0,a.print(pa,"4","9"),a.style=2,a.print("[edit]",pa.length+"+5","9"),a.style=0,a.button("","2","9+4p",pa.length+"+9","4",function(){b.inputName(b.intro)},!1),0===Aa?(a.style=7,a.button("[upgrade account]",pa.length+
"+11","10-4p","19","4",e,!1)):(a.style=7,boost=0<Aa?"lvl "+Aa:"",0<Aa&&(c="adv + "+boost,a.print(c,pa.length+"+12","9"))),a.style=2,a.style=7,c=0<Aa?"adv + lvl "+Aa:"activate adv +",a.button(c,"1.0-"+(4+c.length),"1.0-21",""+(c.length+2),"4",function(){b.paymentRedirect();e()},!0),a.style=0):!1!==la||""!==pa&&null!==pa?!1!==la&&null===pa&&(a.style=2,a.print("display name not set","2","6"),a.style=0,a.print("> [edit name]","2","9"),a.button("","2","9+4p","1.0-4","4",function(){b.inputName(b.intro)},
!1)):(a.style=2,a.print("user data not detected","2","6"),a.style=0,a.print("> create account","2","9"),a.button("","2","9+4p","1.0-4","3",function(){b.inputName(b.intro)},!1),a.print("> login to existing account","2","12"),a.button("","2","12+4p","1.0-4","3",function(){b.requestRecovery(function(){b.account(b.intro)})},!1));a.style=2;a.print("0.0.6.3 DEV001","2","1.0-4");a.style=0;b.nav(function(){b.intro()});a.print("menu","1.0-9","2");a.button("","1.0-9","2+4p","4","5",function(){b.menu(b.intro)},
!1);b.discord();b.startButton()};this.startButton=function(){a.button("start","2","1.0-12+"+(0).toString(),"1.0-4","8",function(){a.clear();y=!1;a.renderer.className="";STATE=function(){};START=!0;firebase.analytics().logEvent("game_start");R.connect();b.load();b.discord()})};this.discord=function(){a.style=3;a.sprite(0,72,16,16,"1.0-12","1.0-5+4p",16,16);a.print("discord","1.0-9","1.0-4");a.link("","1.0-13","1.0-5","12","4","https://discord.gg/ACewNWH");a.style=0};this.load=function(){b.STATE=function(){b.target();
b.setBattleName();b.discord();b.wallet()};b.TIMELIST=[];ya.scan(R.name,function(g){for(var c={$jscomp$loop$prop$t$90$170:0};c.$jscomp$loop$prop$t$90$170<g.length;c={$jscomp$loop$prop$t$90$170:c.$jscomp$loop$prop$t$90$170},c.$jscomp$loop$prop$t$90$170++)b.TIMELIST[c.$jscomp$loop$prop$t$90$170]={uid:g[c.$jscomp$loop$prop$t$90$170].uid,utc:g[c.$jscomp$loop$prop$t$90$170].utc,time:g[c.$jscomp$loop$prop$t$90$170].time,name:"...",boost:g[c.$jscomp$loop$prop$t$90$170].boost},ya.requestName(g[c.$jscomp$loop$prop$t$90$170].uid,
function(p){return function(w){b.TIMELIST[p.$jscomp$loop$prop$t$90$170].name=w;b.STATE()}}(c)),ya.checkTime(la,g[c.$jscomp$loop$prop$t$90$170].uid,g[c.$jscomp$loop$prop$t$90$170].time);c=b.TIMELIST.length<Ma?b.TIMELIST.length:Ma;var f=[];switch(Na){case 0:f=g.slice(0,c);break;case 1:for(g=g.slice();f.length<c;){var h=Math.floor(Math.random()*g.length);f.push(Object.assign({},g[h]));g.splice(h,1)}}b.BATTLE=f.slice();b.STATE()});$a=!0;b.discord();b.wallet();b.target();q=0};this.ready=function(){$a=
!1;b.STATE()};this.play=function(){a.clear();b.nav(b.play);va=!1;a.style=0};this.complete=function(){va=!0;a.clear();b.STATE=function(){};b.nav(b.complete);var g="stage complete!";a.style=0;a.print(g,"0.5-"+2*Math.round(g.length/2),"0.3-1",2);a.style=0;R.COMPLETE=!0;window.setTimeout(function(){!1===la||null===la?(b.register(),b.STATE=function(){b.results();z.replay()}):(b.STATE=function(){b.results()},z.REPLAY||(b.STATE=function(){},ya["export"](b.results)))},2E3);g=z.param().model+" ("+(z.param().power+
1)+"/"+(z.param().drag+1)+"/"+(z.param().sensitivity+1)+"/"+(z.param().ease+1)+")";firebase.analytics().logEvent("stage_complete",{operator_id:pa,time:z.AT(),penalty:z.PENALTY(),score:z.AT()+z.PENALTY(),seed:R.name,rating:Math.round(R.generate.DISTANCE/(z.AT()+z.PENALTY())),distance:R.generate.DISTANCE,vehicle:g})};this.results=function(){b.STATE=function(){b.results()};a.clear();a.style=0;va=!0;var g=0,c=z.CHECKPOINT[4]-1E4*z.CHECKPOINT[5];if((c<Wa||!1===Wa)&&(Wa=c),0<b.TIMELIST.length){for(var f=
0;f<b.TIMELIST.length;f++)if(c<b.TIMELIST[f].time){g=f+1;break}0==g&&(g=b.TIMELIST.length+1)}b.nav(b.results);a.style=5;a.print("stage complete! "+R.name,"2","2");a.style=0;c=a.time(c);a.print(c,"2","5",2);f=z.overwrite(z.CHECKPOINT,R.best,!1);0!=g?a.print("rank "+g,2*c.length+"+3".toString(),"5+4p"):f?(f=Oa?"challenge victory!":"new record!",a.style=1,a.print(f,2*c.length+"+3".toString(),"5+4p"),a.style=0):Oa&&a.print("challenge failed",2*AT.length+"+3".toString(),"5+4p");c=9;f=z.CHECKPOINT;if(320<
k){for(var h=1;h<f.length-1;h++){a.style=5;a.print("cp "+h,"2",c+"+"+h.toString());h;var p=f[h],w=b.split(h);a.print(w,"0.5+1",c+"+"+h.toString());"number"==typeof f[h]?(a.style=0,p=a.time(f[h])):(a.style=4,p="penalty",d="");a.print(p,"0.5 -1-"+p.length.toString(),c+"+"+h.toString());a.style=0;c+=1}c+=5}1===g&&(a.style=4,a.print("new record!","2",c.toString(),2),a.style=0);a.button("issue challenge","0.5+1","1.0-20","0.5-3","4",b.challenge);a.button("modify vehicle","2","1.0-20","0.5-3","4",function(){a.backdrop();
b.vehicle(b.results)});a.button("next stage","2","1.0-12","1.0-4","8",function(){b.next()});a.button("restart stage","2","1.0-4","0.5-3","4",function(){b.reset("complete")});a.button("view replay","0.5+1","1.0-4","0.5-3","4",function(){va=!1;uas.replay();b.replay()})};this.checkpoint=function(g){g=void 0===g?!1:g;a.clear();a.style=0;b.nav(function(){b.checkpoint(g)});var c="";g?c+="missed checkpoint X "+Math.abs(z.CHECKPOINT[5]):c=this.split(z.OBJECTIVE);a.style=4;a.text(c,16,32);a.style=0};this.split=
function(g){var c="",f=R.best[g]-z.CHECKPOINT[g],h=2,p="";return Number.isNaN(f)?void 0===z.CHECKPOINT[g]?(h=4,c+="- 100 sec"):void 0===R.best[g]&&0>R.best[5]?(h=1,c+="+ 100 sec"):void 0===R.best[g]&&(h=1,c+="new time!"):(0<f?(p="+ ",h=1):0>f?(p="- ",h=4):p="+ ",f=Math.abs(f),c+="( "+p+a.time(f)+" )"),a.style=h,c};this.battle=function(){var g=new pb(ya.save(ya.tape),z.MODEL,z.PAINT);fa.push(g);b.reset()};this.replay=function(){if(!z.IMPORT&&!Ca&&(b.STATE=function(){b.replay()},a.clear(),Fa?b.nav(function(){b.replay()}):
b.nav(b.results),!qb)){uas.AUTOPILOT?b.autopilot():b.drone();var g={};for(g.$jscomp$loop$prop$e$95$172=a.style=0;4>g.$jscomp$loop$prop$e$95$172;g={$jscomp$loop$prop$e$95$172:g.$jscomp$loop$prop$e$95$172},g.$jscomp$loop$prop$e$95$172++){var c="7+"+(4*g.$jscomp$loop$prop$e$95$172).toString(),f=g.$jscomp$loop$prop$e$95$172===uas.CAM-1?48:40;a.button("",c+"-10p","1.0-4+4p","3","4",function(h){return function(){uas.CAM=h.$jscomp$loop$prop$e$95$172+1;b.STATE()}}(g),!1);a.sprite(f,64,8,8,c,"1.0-4",8,8)}a.style=
0;g=(uas.AUTOPILOT||uas.TARGETING)&&0<uas.TARGET&&0<uas.TARGETS.length?b.TIMELIST[uas.TARGET-1].name:pa;(uas.AUTOPILOT||uas.TARGETING)&&a.print(g,"2","1.0-7");a.button("","0","1.0-8+4p","20","4",function(){(uas.TARGETING||uas.AUTOPILOT)&&(uas.TARGET+=1,uas.TARGET%=uas.TARGETS.length,b.STATE())},!1)}};this.autopilot=function(){a.style=0;a.style=0<uas.POV?4:2;a.sprite(72,64,8,8,"3","1.0-4",8,8);a.button("","3-10p","1.0-4+4p","3","4",function(){uas.POV=(uas.POV+1)%3;b.STATE()},!1);Fa||(a.style=2,a.print("<",
"2","2"),a.button("","2","2+4p","7","8",function(){b.results(function(){b.replay()})},!1))};this.drone=function(){a.style=uas.TARGETING?4:2;a.sprite(64,64,8,8,"3","1.0-4",8,8);a.button("","3-10p","1.0-4+4p","3","4",function(){uas.TARGETING=!uas.TARGETING;b.STATE()},!1)};this.next=function(){a.clear();$a=!0;bb=gb=Oa=!1;b.PATH=!1;custom_seed="";R.name="";b.BATTLE=[];Wa=!1;window.history.pushState("","","/");Ga.clear();z.REPLAY=!1;z.RESET=!0;z.disconnect();for(var g=0;g<fa.length;g++)fa[g].disconnect();
uas.reset(!0);fa=[];R.SNOW&&oa.remove(R.snow.mesh);R.reset();Ca=va=!1;ya.PLAY=!1;b.load();firebase.analytics().logEvent("next_stage")};this.dnf=function(){b.STATE=function(){b.dnf()};a.backdrop(!1);a.clear();b.nav(b.dnf);firebase.analytics().logEvent("dnf");a.print("dnf","0.5-3+3p","0.5-8",2);a.button("restart stage?","2","0.5+8","1.0-4","1.0-4",function(){b.reset("dnf")},!1)};this.reset=function(g){g=void 0===g?"reset":g;fa.index=0;a.clear();b.nav(b.play);Ca=!0;va=!1;z.reset(!1);for(var c=0;c<fa.length;c++)fa[c].reset();
firebase.analytics().logEvent("stage_restart",{status:g})};this.hide=function(){var g=this;this.STATE=function(){g.hide()};style=1;a.clear();b.nav(T)};this.update=function(g){g=void 0===g?!1:g;va||!Ca||Ua?!1!==g&&(a["delete"](16,16,l-64,16),a.text(a.time(g),16,16)):(a["delete"](16,16,l-64,16),a["delete"](16,k-32,64,16),a.text(a.time(z.AT()),16,16),a.text(z.SPEED.toString(),16,k-32))};this.loading=function(){for(var g="";g.length<Math.floor(cb/500)%4;)g+=".";va||(a["delete"](16,16,160,8),a.style=2,
a.text("stage generating"+g,16,16),a.style=0);q++};this.scanning=function(){if(0===T.TIMELIST.length&&ya.SCAN&&!va){a["delete"](16,72,88,8);for(var g="";g.length<Math.floor(cb/500)%4;)g+=".";a.style=5;a.text("scanning"+g,16,72)}};this.target=function(){a.clear();b.discord();b.wallet();b.STATE=function(){b.target()};b.nav(b.target);var g,c,f=R.name;if($a||(a.style=2,a.print("stage generated.","2","2"),ya.SCAN?a.style=2:(a.style=0,a.button("ready","2","1.0-10","1.0-4","8",function(){a.clear();R.SNOW&&
oa.add(R.snow.mesh);b.STATE=function(){};R.generate.END=!1;b.play();z.SPECTATE=!1;Ca=!0;z.connect(R.start,R.surface,!1);b["import"]();firebase.analytics().logEvent("stage_start")}),b.discord(),b.wallet(),a.style=1,0<b.BATTLE.length&&a.button("spectate!","1.0-14","1.0-18","12","3",function(){Ca=!1;R.generate.END=!1;R.SNOW&&oa.add(R.snow.mesh);a.style=0;z.connect(R.start,R.surface);Fa=!0;b["import"]();a.clear();oa.add(R.generate.stars);firebase.analytics().logEvent("spectate_start")},!1))),a.style=
5,a.print(f,"2","5-1p",2),a.style=0,0!==b.TIMELIST.length||!ya.SCAN)if(0!==b.TIMELIST.length){var h=b.TIMELIST.slice();for(f=0;f<h.length;f++)for(var p=0;p<h.length;p++)h[f].time<=h[p].time&&h[f].utc<h[p].utc&&f>p&&(g={},Object.assign(g,h[f]),c={},Object.assign(c,h[p]),h[f]=c,h[p]=g);a.style=2;a.print("best time:","2","9");a.style=0;a.print(a.time(h[0].time),"2","12",2);a.style=5;g=(f=h.length<Ja)?h.length:Ja;f=f?0:h.length-Ja;for(c=0;c<g;c++){p="16+"+2*c;a.style=5;a.print(c+1+".","2",p);a.style=
h[c].boost?7:5;h[c].boost&&a.sprite(24,112,16,16,"0.5+1",p+"-1+4p",16,16);a.print(h[c].name,"5",p);a.style=5;var w=a.time(h[c].time);a.print(w,"0.5-1-"+w.length,p)}0<f&&a.print("+ "+f+" more entries","2",2*g+"+17")}else a.style=2,a.print("no entries found.","2","9"),a.style=0};this.displayResults=function(g){g=b.TIMELIST;a.style=2;a.print("best time:","2","9");a.style=0;a.print(a.time(g[0].time),"2","12",2);a.style=5;var c=g.length<Ja+4,f=c?g.length:Ja+4;c=c?0:g.length-Ja+4;for(var h=0;h<f;h++)a.print(h+
1+". "+g[h].name,"2","16+"+2*h),a.print(a.time(g[h].time),"18","16+"+2*h);0<c&&a.print("+ "+c+" more entries","2",2*f+"+17")};this.setBattleName=function(){for(var g=0;g<b.BATTLE.length;g++)b.BATTLE[g].name=b.TIMELIST[g].name};this["import"]=function(){b.setBattleName();for(var g={$jscomp$loop$prop$i$105$174:0};g.$jscomp$loop$prop$i$105$174<b.BATTLE.length;g={$jscomp$loop$prop$i$105$174:g.$jscomp$loop$prop$i$105$174},g.$jscomp$loop$prop$i$105$174++)z.IMPORT=!0,ya["import"](R.name+"/"+b.BATTLE[g.$jscomp$loop$prop$i$105$174].uid,
function(c){return function(f){b.BATTLE[c.$jscomp$loop$prop$i$105$174].IMPORT_BUFFER=[];z.INPUTS=[];b.BATTLE[c.$jscomp$loop$prop$i$105$174].data=[];b.BATTLE[c.$jscomp$loop$prop$i$105$174].param={power:f.param.power,drag:f.param.drag,sensitivity:f.param.sensitivity,model:f.param.model,paint:f.param.paint};b.BATTLE[c.$jscomp$loop$prop$i$105$174].cp=f.cp;for(var h=0;h<f.debug.length;h++)f.debug[h].time,f.debug[h].position,f.debug[h].normal,f.debug[h].rotation,f.debug[h].U,f.debug[h].D,f.debug[h].L,f.debug[h].R,
b.BATTLE[c.$jscomp$loop$prop$i$105$174].data.push({U:f.debug[h].U,D:f.debug[h].D,L:f.debug[h].L,R:f.debug[h].R,time:f.debug[h].time});c.$jscomp$loop$prop$i$105$174===b.BATTLE.length-1&&z["import"]()}}(g))};this.uas=function(g){a.clear();a.style=0;b.STATE=function(){b.uas()};a.backdrop();a.sprite(16,64,8,8,"1.0-4+2p","2",8,8);a.button("","2","2","1.0","4",function(){a.backdrop(!1);b.replay()},!1);a.style=0;a.print("spectator controls","2","2");a.print("pilot mode","2","6");a.style=2;a.print("arrow            pitch/yaw/roll",
"2","10");a.print("shift + arrow    roll/yaw modifier","2","12");a.print("space            power +","2","14");a.print("shift + space    power -","2","16");a.print("ctrl:            roll/yaw toggle","2","18");a.print("r                reset","2","20");a.print("t                targeting mode toggle","2","22");a.print("shift + arrow    change target (targeting)","2","24");a.style=0};this.timelist=function(){a.style=0};this.save=function(){var g=pa+"#"+z.MODEL+"#"+z.PAINT+"#"+z.param().power+z.param().drag+
+z.param().sensitivity+"#"+Date.now();g!==E&&(E=g,b.cSave("SAVE",E))};this.vehicle=function(g){b.STATE=function(){b.vehicle(g)};va=!0;a.clear();b.title("modify vehicle",function(){g();b.save()},function(){b.menu(g);b.save()});z.REPLAY&&b.reset();var c=[],f=z.param();c.push({id:"power",value:f.power,funct:function(L){z.tune.power(L)}});c.push({id:"drag",value:f.drag,funct:function(L){z.tune.drag(L)}});c.push({id:"sensitivity",value:f.sensitivity,funct:function(L){z.tune.sensitivity(L)}});a.sprite(0,
0,1,1,"2","8+-5+3","1.0-2-2",1);a.print("model","2","8+");a.print(z.models()[z.MODEL].name,"2+8","8+");a.sprite(0,0,1,1,"2","8++3","1.0-2-2",1);a.button(">","1.0-6","8++4p","4","4",function(){z.MODEL+=1;z.MODEL>z.models().length-1&&(z.MODEL=0);z.body();b.vehicle(g)},!1);a.button("<","1.0-12","8++4p","4","4",function(){--z.MODEL;0>z.MODEL&&(z.MODEL=z.models().length-1);z.body();b.vehicle(g)},!1);a.sprite(0,0,1,1,"2","8+5+-5+3","1.0-2-2",1);a.print("paint","2","8+5+");a.print(wb[z.PAINT],"10","8+5+");
a.sprite(0,0,1,1,"2","8+5++3","1.0-2-2",1);a.button(">","1.0-6","8+5++4p","4","4",function(){z.PAINT+=1;z.PAINT>Ra.length-1&&(z.PAINT=0);z.paint();b.vehicle(g)},!1);a.button("<","1.0-12","8+5++4p","4","4",function(){--z.PAINT;0>z.PAINT&&(z.PAINT=Ra.length-1);z.paint();b.vehicle(g)},!1);for(f={$jscomp$loop$prop$t$107$176:0};f.$jscomp$loop$prop$t$107$176<c.length;f={$jscomp$loop$prop$t$107$176:f.$jscomp$loop$prop$t$107$176},f.$jscomp$loop$prop$t$107$176++){var h="8+5+5+"+(5*f.$jscomp$loop$prop$t$107$176).toString();
a.print(c[f.$jscomp$loop$prop$t$107$176].id,"2",h);a.sprite(0,0,1,1,"2",h+"+3","1.0-2-2",1);for(var p={$jscomp$loop$prop$e$108$178:0};6>p.$jscomp$loop$prop$e$108$178;p={$jscomp$loop$prop$e$108$178:p.$jscomp$loop$prop$e$108$178},p.$jscomp$loop$prop$e$108$178++){var w="1.0-18+"+(3*p.$jscomp$loop$prop$e$108$178).toString(),H=p.$jscomp$loop$prop$e$108$178<=c[f.$jscomp$loop$prop$t$107$176].value?48:40;a.button("",w+"-10p",h+"+4p","3","4",function(L,m){return function(){c[L.$jscomp$loop$prop$t$107$176].funct(m.$jscomp$loop$prop$e$108$178);
b.vehicle(g)}}(f,p),!1);a.sprite(H,64,8,8,w,h,8,8)}}};this.scan=function(g,c){};this.settings=function(g){b.STATE=function(){b.settings(g)};b.SETTINGS=!0;b.saveSettings();a.clear();y||a.backdrop();b.title("settings",g,b.menu);var c=6;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);c+=2;a.print("account","2",""+c);a.print("[edit]","1.0-2-6",""+c);a.button("","2",c+"+4p","1.0-4","5",function(){b.account(function(){g()})},!1);c+=3;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);c+=2;a.print("ghost config","2",""+c);a.print("[edit]",
"1.0-2-6",""+c);a.button("","2",c+"+4p","1.0-4","5",function(){b.ghostConfig(g)},!1);c+=3;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);c+=2;hb?(f=ab?"enabled":"disabled",a.print("display touch hitboxes","2",""+c),a.print(f,"1.0-2-"+f.length,""+c),a.button("","2",c+"+4p","1.0-4","5",function(){ab=!ab;b.settings(g)},!1)):(a.print("keybindings","2",""+c),a.print("arrow / wasdr","1.0-15",""+c));c+=3;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);c+=2;a.print("pixel scale","2",""+c);a.print(""+La,"1.0-18",""+c);a.button("+",
"1.0-6",c+"+4p","4","4",function(){2>La&&(La+=.5);a.style=0;b.settings(g);ha()},!1);a.button("-","1.0-12",c+"+4p","4","4",function(){1<La&&(La-=.5);a.style=0;b.settings(g);ha()},!1);c+=3;a.sprite(0,0,1,1,"2",""+c,"1.0-4",1);c+=2;a.print("camera mode","2",""+c);var f=z.FPV?"fpv":"tpv";a.print(f,"1.0-6",""+c);a.button("","2",c+"+4p","1.0-4","5",function(){z.FPV=!z.FPV;b.settings(g)},!1);a.sprite(0,0,1,1,"2",""+(c+3),"1.0-4",1);a.print("www.procedural.ca","2","1.0-10");a.print("www.ginko.ltd","2","1.0-8");
b.discord();b.wallet();a.style=0};this.saveSettings=function(){B=Ma+"#"+Na+"#"+(ab?1:0)+"#"+(rb?1:0);b.cSave("SETTINGS",B)};this.ghostConfig=function(g,c){b.STATE=function(){b.ghostConfig(g)};b.saveSettings();a.clear();y||a.backdrop();b.title("ghost config",g,function(){b.settings(g)});a.sprite(0,0,1,1,"2","6","1.0-4",1);a.print("ghost limit","2","8");var f=Ma.toString();a.print(f,"1.0-13-"+f.length,"8");a.button(">","1.0-6","8+4p","4","4",function(){50>Ma&&(Ma+=1);b.ghostConfig(g)},!1);a.button("<",
"1.0-12","8+4p","4","4",function(){0<Ma&&--Ma;b.ghostConfig(g)},!1);a.sprite(0,0,1,1,"2","11","1.0-4",1);a.print("ghost priority","2","13");f=0===Na?"best":"random";a.print(f,"1.0-13-"+f.length,"13");a.button(">","1.0-6","13+4p","4","4",function(){Na+=1;1<Na&&(Na=0);b.STATE()},!1);a.button("<","1.0-12","13+4p","4","4",function(){--Na;0>Na&&(Na=1);b.STATE()},!1);a.sprite(0,0,1,1,"2","16","1.0-4",1);a.print("ghost particles","2","18");f=fb?"enabled":"disabled";a.print(f,"1.0-2-"+f.length,"18");a.button("",
"2","18+4p","1.0-4","4",function(){fb=!fb;for(var h=0;h<fa.length;h++)fa[h].toggleEmitter(fb);b.ghostConfig(g)},!1);a.sprite(0,0,1,1,"2","21","1.0-4",1)};this.controls=function(g){a.clear();b.title("controls",g,b.menu)};this.fullscreen=function(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()};this.prompt=function(){a.clear();a.print("specialstage.io","4","4",2);a.print("-","4","8",2)};this.challenge=function(g){a.clear();
b.nav(function(){b.challenge()},b.menu);a.print("issue challenge url","2","2");a.print("-","2","4");a.style=2;a.print("issued by","2","6");a.style=0;a.print("> "+pa,"2","9");a.style=2;a.print("[edit]",pa.length+"+9","9");a.button("","2","9+4p",pa.length+"+5","4",function(){b.inputName(b.challenge,!1)},!1);a.style=2;a.print("seed","2","13");a.style=5;a.print(R.name,"2","15");a.style=2;a.print("time","2","19");g=a.time(z.CHECKPOINT[4]-1E4*z.CHECKPOINT[5]);a.style=5;a.print(g,"2","21");a.style=0;a.button("copy challenge url",
"1","1.0-8","1.0-2","8",function(){a.clear();b.encodeURL();window.setTimeout(b.results,2E3)})};this.appearance=function(){a.clear();b.breadcrumb("appearance",this.vehicle,this.state);b.nav(function(){b.appearance()},b.menu)};this.inputName=function(g,c,f){c=void 0===c?!1:c;f=void 0===f?"enter display name:":f;b.STATE=function(){b.inputName(g,c,f)};a.clear();va=!0;c?b.nav(function(){g()},b.menu):b.exit(g);a.print(f,"2","2");a.textinput(pa,"2","4","1.0-2","6","operator_id");var h=document.getElementById("operator_id");
a.style=2;a.button("cancel","1.0-10","20","8","4",function(){g()},!1);a.style=0;a.button("accept","2","14","1.0-4","6",function(){a.clear();a.print("submitting name to db","2","2");pa=xb(h.value.toLowerCase());!1===la&&1<pa.length&&null!==pa?firebase.auth().signInAnonymously().then(function(){la=firebase.auth().currentUser.uid;b.submitName(la,g,c);b.STATE=function(){}})["catch"](function(p){p.code;p.message}):!1!==la&&1<pa.length&&null!==pa?b.submitName(la,g,c):(a.clear(),a.print("invalid name","2",
"2"),window.setTimeout(function(){b.inputName(g,c,f)},1E3))},!0)};this.submitName=function(g,c,f){f=void 0===f?!1:f;1<pa.length&&10>pa.length?firebase.database().ref("uid/"+g).set({name:pa},function(h){h?(a.clear(),h="PERMISSION_DENIED"===h.code?"invalid name":"network error",a.print(h,"2","2"),window.setTimeout(function(){b.inputName(c,f)},1E3)):(a.clear(),a.print("name change successful","2","2"),Va?window.setTimeout(c,1E3):window.setTimeout(function(){b.updateRecovery(c,"add recovery email:","skip")},
1E3))}):(a.clear(),a.print("invalid name","2","2"),window.setTimeout(function(){b.inputName(c,f)},1E3))};this.confirmMenu=function(g,c,f){g=void 0===g?"":g;a.clear();b.exit(f);a.print(g,"2","2");a.sprite(0,0,1,1,"2","6","1.0-4",1);a.print("> confirm","2","8");a.button("","2","8+4p","1.0-4","4",c,!1);a.sprite(0,0,1,1,"2","11","1.0-4",1);a.print("> cancel","2","13");a.button("","2","13+4p","1.0-4","4",f,!1);a.sprite(0,0,1,1,"2","16","1.0-4",1)};this.encodeURL=function(){for(var g="",c=R.name,f=0;f<
c.length;f++){var h=c.charAt(f);h=" "===h?"-":h;g+=h}g=g+"/"+la;window.history.pushState("","","/");c=window.location.href;var p="./#/"+g;navigator.clipboard.writeText("https://specialstage.io/#/"+g).then(function(){a.print("url copied to clipboard","2","2");window.history.pushState("","",p)},function(){window.history.pushState("","",p);a.print("url copied to address bar","2","2")});firebase.analytics().logEvent("challenge_issued",{url:c+"#/"+g})};this.decodeURL=function(){for(var g=window.location.href,
c="",f=[],h=!1,p=0,w=0;w<g.length;w++){var H=g.charAt(w);h?"/"===H?(Oa=!0,p++):(1===p&&(H="-"===H?" ":H,c+=H),1<p&&(f+=H)):"#"===H&&(h=!0,bb=!0,p=0)}Oa&&0<f.length?(b.custom_seed=c,R.name=c,b.CHALLENGES={seed:c,uid:f}):bb&&(b.custom_seed=c,R.name=c,Oa=!1);Oa&&firebase.analytics().logEvent("challenge_accepted",{url:g})};this.cSave=function(g,c){var f=new Date;f.setTime(f.getTime()+2808E7);f="expires="+f.toUTCString();document.cookie=g+"="+c+";"+f+";path=/"};this.cLoad=function(g){g+="=";for(var c=
document.cookie.split(";"),f=0;f<c.length;f++){for(var h=c[f];" "==h.charAt(0);)h=h.substring(1);if(0==h.indexOf(g))return h.substring(g.length,h.length)}return""};this.checksave=function(){var g=b.cLoad("SAVE");if(0!==g.length&&null!=g){for(var c=0,f="",h="",p="",w="",H=0,L=0;L<g.length;L++){var m=g.charAt(L);if("#"!==m)switch(H){case 1:c=parseInt(m);break;case 2:f+=m;break;case 3:h+=g.charAt(L),p+=g.charAt(L+1),w+=g.charAt(L+2),L+=2}else H++}z.MODEL=parseInt(c);z.PAINT=parseInt(f);z.paint();z.tune.power(parseInt(h));
z.tune.drag(parseInt(p));z.tune.sensitivity(parseInt(w))}else z.PAINT=0,z.paint();if(g=b.cLoad("SETTINGS"),0!==g.length&&null!=g){c=0;p=h=f="";for(w=0;w<g.length;w++)if(H=g.charAt(w),"#"!==H)switch(c){case 0:f+=H;break;case 1:Na=parseInt(H);break;case 2:h=parseInt(H);break;case 3:p=parseInt(H)}else c++;Ma=parseInt(f);ab=0!==h;1===p&&(rb=!0)}};this.credit=function(){a.clear();a.print("procedural.ca","2","1.0-6");a.print("ginko.ltd","2","1.0-4")};this.promo=function(){a.clear();T.nav();a.style=0;a.print("0.0.6.2",
"2","2");a.sprite(0,88,47,8,"2","0.5-6",188,32,2);a.sprite(49,88,40,8,"2","0.5+6",160,32,2);a.sprite(1,0,255,16,"2","1.0-6",255,16);a.print("www.specialstage.io  ","2","1.0-8")};this.banner=function(){a.clear();a.style=0;a.sprite(8,64,8,8,"0.5-1+160p","0.5-2",8,8);a.sprite(0,88,88,8,"0.5-160p","0.5-2",88,8);a.print("specialstage.io","0.5-160p","0.5+1",2);a.print("> asynchronous multiplayer arcade racing","0.5-160p","0.5+5",1);a.print("> no download required","0.5-160p","0.5+7",1)};this.fpv=function(){a.clear();
a.print("https://specialstage.io - 0.0.4","2","2");a.print("new feature","4","0.5");a.print("first person view (fpv)","4","0.5 + 4",2);window.setTimeout(function(){a.clear();a.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.biome=function(){a.clear();a.print("https://specialstage.io - 0.0.4","2","2");a.print("new feature","4","0.5");a.print("ice biome","4","0.5 + 4",2);window.setTimeout(function(){a.clear();a.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.physics=function(){a.clear();
a.print("https://specialstage.io - 0.0.4","2","2");a.print("update","4","0.5");a.print("improved vehicle physics","4","0.5 + 4",2);window.setTimeout(function(){a.clear();a.print("https://specialstage.io - 0.0.4","2","2")},4E3)};this.endtag=function(){a.clear();a.print("play at","2","0.25-4");a.print("www.specialstage.io","2","0.25",2);a.print("challenges posted on discord","4","0.25+ 6");a.print("> discord.specialstage.io","4","0.25 + 9");window.setTimeout(b.music,2E3)};this.music=function(g){window.setTimeout(function(){a.print("procedural.ca",
"2","1.0-12")},500);window.setTimeout(function(){a.print("ginko.ltd","2","1.0-10")},1E3);window.setTimeout(function(){},3E3)};this.updates=function(){a.clear();a.print("https://specialstage.io - 0.0.4","2","2");a.print("updates","2","6");a.print("> added ice biome","2","10");a.print("> added fpv camera","2","12");a.print("> added snow particle effects","2","14");a.print("> added terrain drag penalty","2","16");a.print("> improved vehicle physics","2","18");a.print("> increased gravity","2","20");
a.print("> decreased air resistance","2","22");a.print("> disabled DNF timeout during button input for big jumps","2","24");a.print("> removed framerate dependecies","2","26");a.print("> reworked ui pixel scaling","2","28");window.setTimeout(function(){a.clear()},1E4)};this.plug=function(g){if("n"===g.key)switch(x){case 0:a.clear();window.setTimeout(b.promo,1E3);x++;break;case 1:window.setTimeout(b.biome,1E3);x++;z.CAMERA=4;break;case 2:window.setTimeout(b.physics,1E3);x++;z.CAMERA=2;break;case 3:window.setTimeout(b.fpv,
1E3);x++;z.CAMERA=3;break;case 4:window.setTimeout(b.endtag,1E3);x++;z.CAMERA=1;break;case 5:a.clear(),x=0}};this.url=function(){for(var g="";g.length<R.name.length;){var c=R.name.charAt(g.length);g+=" "===c?"-":c}return"specialstage.io/#/"+g};this.utc=function(g){g=(new Date(g)).toLocaleString("en-GB",{timeZone:"UTC"});for(var c="",f=0;f<g.length;f++)","!==g.charAt(f)&&(c+=g.charAt(f));return c};this.stageIntro=function(){var g=this;this.STATE=function(){g.stageIntro()};a.clear();ob=!0;T.nav(this.STATE);
var c=this.url();a.timeouts.push(window.setTimeout(function(){a.style=5;a.print(c,"2","2")},250));a.timeouts.push(window.setTimeout(function(){a.style=2;a.print("event seed","2","6")},250));a.timeouts.push(window.setTimeout(function(){a.style=0;a.print(R.name,"2","9",2)},500));a.timeouts.push(window.setTimeout(function(){T.BATTLE.length;a.style="2";a.print(R.generate.BIOMES[R.generate.BIOME].name+" biome","2","13");a.style="0"},1E3));a.timeouts.push(window.setTimeout(function(){a.style="0";a.sprite(16,
72,16,16,"1.0-27","1.0-4",16,16);a.print("variable self - eagle","1.0-23","1.0-4")},2E3));T.stageEntries()};this.stageReplay=function(){var g=this;this.STATE=function(){g.stageReplay()};a.clear();T.nav(this.STATE);a.print(fa[uas.TARGET-1].name,"1.0-2-"+fa[uas.TARGET-1].name.length,"1.0-4")};this.stageResults=function(){nb=!0;this.STATE=function(){b.stageResults()};a.clear();T.nav(this.STATE);var g=b.url();a.timeouts.push(window.setTimeout(function(){a.style="5";a.print(g,"2","2")},250));a.timeouts.push(window.setTimeout(function(){a.style=
2;a.print("event result","2","6")},500));a.timeouts.push(window.setTimeout(function(){a.style=0;a.print(T.BATTLE[0].name,"2","9",2)},750));a.timeouts.push(window.setTimeout(function(){a.style=1;a.print("stage rank 1","2+"+2*T.BATTLE[0].name.length+"+1","9+4p")},1E3));a.timeouts.push(window.setTimeout(function(){a.style=0;a.sprite(0,0,1,1,"2","13","1.0-4",1)},1250));var c=b.TIMELIST;a.style=5;var f=c.length<Ja+4,h=f?c.length:Ja+4;f||(c.length,Ja);for(f={$jscomp$loop$prop$i$130$180:0};f.$jscomp$loop$prop$i$130$180<
h;f={$jscomp$loop$prop$i$130$180:f.$jscomp$loop$prop$i$130$180},f.$jscomp$loop$prop$i$130$180++)a.timeouts.push(window.setTimeout(function(p){return function(){var w="16+"+3*p.$jscomp$loop$prop$i$130$180;a.print(p.$jscomp$loop$prop$i$130$180+1+". "+c[p.$jscomp$loop$prop$i$130$180].name,"2",w);var H=a.time(c[p.$jscomp$loop$prop$i$130$180].time);a.print(H,"1.0-2-"+H.length,w)}}(f),1500+250*f.$jscomp$loop$prop$i$130$180))};this.stageEntries=function(){a.style="5";for(var g=[],c=0;c<b.BATTLE.length;c++)g.push({name:b.BATTLE[c].name,
utc:b.BATTLE[c].utc});T.BATTLE.length;a.timeouts.push(window.setTimeout(function(){a.sprite(0,0,1,1,"2","17","1.0-4",1)},1500));a.style=5;g.length<Ja+6||(g.length,Ja);for(c={$jscomp$loop$prop$e$132$182:0};c.$jscomp$loop$prop$e$132$182<g.length;c={$jscomp$loop$prop$e$132$182:c.$jscomp$loop$prop$e$132$182},c.$jscomp$loop$prop$e$132$182++)a.timeouts.push(window.setTimeout(function(f){return function(){a.style="5";a["delete"]("2","19+"+f.$jscomp$loop$prop$e$132$182%6*3,"1.0","1");a.print(g[f.$jscomp$loop$prop$e$132$182].name,
"2","19+"+f.$jscomp$loop$prop$e$132$182%6*3);a.style="2";a.print(T.utc(g[f.$jscomp$loop$prop$e$132$182].utc),"1.0-21","19+"+f.$jscomp$loop$prop$e$132$182%6*3)}}(c),2E3+500*c.$jscomp$loop$prop$e$132$182)),c.$jscomp$loop$prop$e$132$182===T.BATTLE.length-1&&a.timeouts.push(window.setTimeout(function(){T.replay();qb=!0;STAGE_ENTRIES=STAGE_INTRO=!1},500*c.$jscomp$loop$prop$e$132$182+4E3))};this.mixplug=function(){a.clear();a.format(6,"#555");a.format(7,"#50ffae");a.format(8,"#80f7d2");a.format(9,"#7b1df5");
ka.updateProjectionMatrix();a.style=0;a.sprite(8,64,8,8,"1.0-4+2p","2",8,8);a.style=7;a.style=6;window.setTimeout(function(){a.style=6;a.print("mix","2","1.0-6")},2E3);for(var g={$jscomp$loop$prop$e$133$184:0};15>g.$jscomp$loop$prop$e$133$184;g={$jscomp$loop$prop$e$133$184:g.$jscomp$loop$prop$e$133$184},g.$jscomp$loop$prop$e$133$184++)window.setTimeout(function(c){return function(){a.style=0;a.print("specialstage.io".charAt(c.$jscomp$loop$prop$e$133$184),"2+"+c.$jscomp$loop$prop$e$133$184,"2")}}(g),
100*g.$jscomp$loop$prop$e$133$184);window.setTimeout(function(){a.sprite(0,88,88,8,"2","4",88,8)},1800);a.style=7;a.style=7;window.setTimeout(function(){a.style=7;a.print("low recordings","2","1.0-4")},2E3);a.style=6;window.setTimeout(function(){a.style=6;a.print("(lo-fi house)","1.0-15","1.0-4")},2200);a.style=7;g=document.createElement("img");g.style.zIndex=98;g.style.position="fixed";g.style.top=0;g.style.left=0;g.src="./img/low_promo_4x.gif";g.style.setProperty("mix-blend-mode","lighten");document.body.appendChild(g)};
this.tracklist=function(){a.clear();a.format(6,"#555");a.format(7,"#50ffae");a.format(8,"#80f7d2");a.format(9,"#DA4DFA");a.format(10,"#101010");a.style=0;a.sprite(8,64,8,8,"1.0-4+2p","2",8,8);a.style=3;a.style=4;a.style=1;a.style=0;a.print("specialstage.io","2","2");a.style=9;a.print("X low recordings feature mix","2","4");a.style=5;window.setTimeout(function(){a.style=6;a.print("featuring music by:","2","8")},600);var g=[];a.style=0;g.push(function(){a.print("> evade robots","2","12")});g.push(function(){a.print("> eli cash",
"2","14")});g.push(function(){a.print("> shaman","2","16")});g.push(function(){a.print("> heartwerk","2","18")});g.push(function(){a.print("> blo","2","20")});g.push(function(){a.print("> urbanite","2","22")});g.push(function(){a.print("> rick wade","2","24")});g.push(function(){a.print("> orthographic figure","2","26")});g.push(function(){a.print("> hyas","2","28")});g.push(function(){a.print("> albin & noris","2","30")});a.style=7;for(var c={$jscomp$loop$prop$e$134$186:0};c.$jscomp$loop$prop$e$134$186<
g.length;c={$jscomp$loop$prop$e$134$186:c.$jscomp$loop$prop$e$134$186},c.$jscomp$loop$prop$e$134$186++)window.setTimeout(function(f){return function(){a.style=0;g[f.$jscomp$loop$prop$e$134$186]()}}(c),250*c.$jscomp$loop$prop$e$134$186+1E3)};this.sponsor=function(){a.clear();b.nav(this.sponsor);a.timeouts.push(window.setTimeout(function(){a.renderer.className="promo_c"},1E3));a.timeouts.push(window.setTimeout(function(){a.style=2;a.print("music provided by","2","2")},1250));a.timeouts.push(window.setTimeout(function(){a.style=
0;a.print("misplaced recordings","2","4");a.style="0";a.sprite(16,72,16,16,"1.0-27","1.0-4",16,16);a.print("variable self - eagle","1.0-23","1.0-4")},1500))}}function yb(){this.position=new THREE.Vector3;this.velocity=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.up=new THREE.Vector3(0,0,1);var e=[],b=0,l=!1,k=this.up.clone(),q=function(){return{position:new THREE.Vector3,distance:new THREE.Vector3,direction:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3(0,
0,1),lerp:1,pitch:{axis:new THREE.Vector3(1,0,0),value:0},roll:{axis:new THREE.Vector3(0,1,0),value:0},yaw:{axis:new THREE.Vector3(0,0,1),value:0},pov:0,target:0,targeting:!1,autopilot:!0}},x=[],n=function(){return{position:new THREE.Vector3,velocity:new THREE.Vector3,lookAt:new THREE.Vector3,up:new THREE.Vector3,pitch:{axis:new THREE.Vector3,value:0},roll:{axis:new THREE.Vector3,value:0},yaw:{axis:new THREE.Vector3,value:0},speed:0}},E=this.AUTOPILOT=!0,B=this.TARGET=0;this.TARGETS=[];this.TARGETING=
!1;var y=this.CAM=1,g=this.POV=0;this.camera=[];this.camera[0]=q();this.camera[0].distance=22;this.camera[0].position.set(0,0,10);this.camera[0].position.lerp=.1;this.camera[0].position.pov=!0;this.camera[1]=q();this.camera[1].distance=24.5;this.camera[1].position.set(0,1,0);this.camera[1].yaw.value=.5708;this.camera[1].pitch.value=.485;this.camera[1].lerp=.1;this.camera[2]=q();this.camera[2].distance=34;this.camera[2].position.set(0,1,0);this.camera[2].yaw.value=3.512;this.camera[2].pitch.value=
.79;this.camera[2].lerp=.1;this.camera[3]=q();this.camera[3].distance=34;this.camera[3].position.set(0,1,0);this.camera[3].yaw.value=5.7916;this.camera[3].pitch.value=.5236;this.camera[3].pov=2;this.camera[3].lerp=.1;this.camera[4]=q();this.camera[4].distance=50;this.camera[4].position.set(0,1,0);this.camera[4].yaw.value=Math.PI;this.camera[4].pitch.value=1.32;this.camera[4].lerp=.075;this.camera[5]=q();this.camera[5].distance=50;this.camera[5].position.set(0,1,0);this.camera[5].yaw.value=Math.PI;
this.camera[5].pitch.value=1.32;this.camera[5].lerp=.075;this.camera[6]=q();this.camera[6].distance=50;this.camera[6].position.set(0,1,0);this.camera[6].yaw.value=Math.PI;this.camera[6].pitch.value=1.32;this.camera[6].lerp=.075;this.camera[7]=q();this.camera[7].distance=50;this.camera[7].position.set(0,1,0);this.camera[7].yaw.value=Math.PI;this.camera[7].pitch.value=1.32;this.camera[7].lerp=.075;this.camera[8]=q();this.camera[8].distance=50;this.camera[8].position.set(0,1,0);this.camera[8].yaw.value=
Math.PI;this.camera[8].pitch.value=1.32;this.camera[8].lerp=.075;this.camera[9]=q();this.camera[9].distance=50;this.camera[9].position.set(0,1,0);this.camera[9].yaw.value=Math.PI;this.camera[9].pitch.value=1.32;this.camera[9].lerp=.075;this.camera[10]=q();this.camera[10].distance=50;this.camera[10].position.set(0,1,0);this.camera[10].yaw.value=Math.PI;this.camera[10].pitch.value=1.32;this.camera[10].lerp=.075;x[0]=n();x[1]=n();x[2]=n();x[3]=n();x[4]=n();x[5]=n();x[6]=n();x[7]=n();x[8]=n();x[9]=n();
x[10]=n();this.reset=function(c){if(void 0===c?0:c)for(this.CAM=1,this.TARGET=0,this.TARGETS=[],ka.up.copy(k),c=0;c<this.camera.length;c++)this.camera[c].target=0;1<e.length?e[b].time=0:(b=0,e=[],e[0]={time:0,position:this.position.clone(),direction:this.direction.clone(),lookAt:this.lookAt.clone(),up:new THREE.Vector3,pitch:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(1,0,0)},roll:{step:0,value:0,power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,1,0)},yaw:{step:0,value:0,
power:7E-4,drag:.98,limit:60,axis:new THREE.Vector3(0,0,1)},velocity:this.velocity.clone(),speed:0})};this.replay=function(){this.TARGET=0;this.CAM=1;for(var c=0;c<this.camera.length;c++)this.camera[c].target=0,this.camera[c].autopilot=!0};this.spectate=function(){this.CAM=this.TARGET=1;for(var c=0;c<this.camera.length;c++)this.camera[c].target=1,this.camera[c].autopilot=!0};this.connect=function(){this.reset()};this.disconnect=function(){this.reset();this.TARGETS=[]};this.pov=function(c,f,h){c=void 0===
c?new THREE.Vector3:c;f=void 0===f?new THREE.Vector3:f;h=void 0===h?new THREE.Vector3:h;var p=Ua||z.END?1E-5:.1;this.up.set(0,0,1);f=f.clone();f.multiplyScalar(-this.camera[0].distance+4*(a.scale-1));f.add(c);f.z+=this.camera[0].position.z;e[b].position.lerp(f,p);e[b].lookAt.copy(h);e[b].up.set(0,0,1)};this.fpv=function(c,f,h,p){c=void 0===c?new THREE.Vector3:c;f=void 0===f?new THREE.Vector3:f;void 0===h&&new THREE.Vector3;p=void 0===p?new THREE.Vector3:p;e[b].position.copy(c);f=f.clone();f.add(c);
e[b].lookAt.copy(f);p=p.clone();e[b].up.copy(p)};this.orbit=function(c,f,h){c=void 0===c?new THREE.Vector3:c;void 0===f&&new THREE.Vector3;h=void 0===h?new THREE.Vector3:h;M.SPACE;f=M.SHIFT;var p=M.UP,w=M.DOWN,H=M.LEFT,L=M.RIGHT,m=M.ZOOM_IN,A=M.ZOOM_OUT;c=c.clone();e[b].yaw=e[b-1].yaw;var I=this.camera[y].position.clone();this.camera[y].distance+=m&&0<this.camera[y].distance?-.5:A&&100>this.camera[y].distance?.5:0;I.multiplyScalar(this.camera[y].distance);this.camera[y].yaw.value+=H?-.05:L?.05:0;
this.camera[y].pitch.value+=p?.05:w?-.05:0;this.camera[y].pitch.value=0>this.camera[y].pitch.value?0:this.camera[y].pitch.value>Math.PI/2-.1?Math.PI/2-.1:this.camera[y].pitch.value;m=this.camera[y].pitch.axis.clone();m.applyAxisAngle(k,this.camera[y].yaw.value);I.applyAxisAngle(k,this.camera[y].yaw.value);I.applyAxisAngle(m,this.camera[y].pitch.value);c.add(I);w=l?1:H||L||p||w?.1:this.camera[y].lerp;H&&f&&0<this.TARGET&&(--this.TARGET,T.replay(),M.RIGHT=!1);L&&f&&this.TARGET<this.TARGETS.length-1&&
(this.TARGET+=1,T.replay(),M.RIGHT=!1);e[b].position.lerp(c,w);e[b].lookAt.copy(h);e[b].up.set(0,0,1)};this.physics=function(c,f,h){if((void 0===c?0:c)>e[b].time){var p=f.position.clone(),w=f.direction.clone();c=f.lookAt.clone();f=f.normal.clone();h=((void 0!==h?h:p).clone(),{});Object.assign(h,e[b]);e=[];b=0;e.push(h);h={};Object.assign(h,e[b]);e.push(h);b++;z.REPLAY?this.AUTOPILOT?1===this.POV?this.pov(p,w,c):2===this.POV?this.fpv(p,w,c,f):this.orbit(p,w,c):this.pilot():z.FPV?this.fpv(p,w,c,f):
this.pov(p,w,p);e[b].time+=Sa}};this.target=function(c){this.lookAt.copy(this.TARGETS[c].position)};this.update=function(c,f){c=void 0===c?0:c;f=void 0===f?this.TARGETS:f;this.CAM!==y?(l=!0,y=this.CAM,this.TARGET=this.camera[y].target,this.TARGETING=this.camera[y].targeting,this.AUTOPILOT=this.camera[y].autopilot,this.POV=this.camera[y].pov,E=this.AUTOPILOT,E?(e[b].position.copy(this.camera[y].position),e[b].position.add(f[this.TARGET].position),e[b].up.copy(this.camera[y].up),l=!0):(e[b].position.copy(x[y].position),
e[b].lookAt.copy(x[y].lookAt),e[b].up.copy(x[y].up),e[b].velocity.copy(x[y].velocity),e[b].pitch.axis.copy(x[y].pitch.axis),e[b].roll.axis.copy(x[y].roll.axis),e[b].yaw.axis.copy(x[y].yaw.axis),e[b].pitch.value=x[y].pitch.value,e[b].roll.value=x[y].roll.value,e[b].yaw.value=x[y].yaw.value,e[b].speed=x[y].speed),T.STATE()):(this.camera[y].target=this.TARGET,this.camera[y].pov=this.POV,this.camera[y].targeting=this.TARGETING,this.camera[y].autopilot=this.AUTOPILOT);this.AUTOPILOT!==E&&(E=this.AUTOPILOT,
this.AUTOPILOT?(e[b].position.copy(this.camera[y].position),e[b].up.copy(this.camera[y].up)):e[b].speed=0);this.POV!==g&&(T.STATE(),g=this.POV,uas.camera[uas.CAM].pov=g);this.TARGET!==B&&(B=this.TARGET,uas.camera[uas.CAM].target=B);this.physics(c,f[Ca?0:this.camera[y].target]);Sa;e[b].time;Sa;1<e.length&&(this.position.copy(e[b].position),this.direction.copy(e[b].direction),this.up.copy(e[b].up),this.lookAt.copy(e[b].lookAt),ka.position.copy(this.position),ka.up.set(this.up.x,this.up.y,this.up.z),
ka.lookAt(this.lookAt));l=!1};this.pilot=function(){var c=e[b],f=M.SPACE,h=M.SHIFT,p=M.UP,w=M.DOWN,H=M.LEFT,L=M.RIGHT;M.TARGET&&(this.TARGETING=!this.TARGETING,M.TARGET=!1,T.replay());c.pitch.value+=p?-c.pitch.power:w?+c.pitch.power:0;h&&!this.TARGETING?c.roll.value+=H?-c.roll.power:L?c.roll.power:0:(c.yaw.value+=H?c.yaw.power:L?-c.yaw.power:0,c.yaw.value*=c.yaw.drag);c.pitch.value*=c.pitch.drag;c.roll.value*=c.roll.drag;c.yaw.value*=c.yaw.drag;c.pitch.axis.applyAxisAngle(c.roll.axis,c.roll.value);
c.pitch.axis.applyAxisAngle(c.yaw.axis,c.yaw.value);c.roll.axis.applyAxisAngle(c.pitch.axis,c.pitch.value);c.roll.axis.applyAxisAngle(c.yaw.axis,c.yaw.value);c.yaw.axis.applyAxisAngle(c.pitch.axis,c.pitch.value);c.yaw.axis.applyAxisAngle(c.roll.axis,c.roll.value);h&&f&&-1<c.speed?c.speed-=.0025:f&&1>c.speed&&(c.speed+=.0025);c.velocity.copy(c.roll.axis);c.velocity.multiplyScalar(c.speed);c.position.add(c.velocity);this.TARGETING?(H&&h&&0<this.TARGET&&(--this.TARGET,T.replay(),M.LEFT=!1),L&&h&&this.TARGET<
this.TARGETS.length-1&&(this.TARGET+=1,T.replay(),M.RIGHT=!1),this.up.set(0,0,1),l?c.lookAt.copy(this.TARGETS[this.TARGET].position):c.lookAt.lerp(this.TARGETS[this.TARGET].position,.05)):(c.up.copy(c.yaw.axis),c.lookAt.copy(c.roll.axis),c.lookAt.add(c.position));x[y].position.copy(c.position);x[y].lookAt.copy(c.lookAt);x[y].velocity.copy(c.velocity);x[y].up.copy(c.up);x[y].pitch.axis.copy(c.pitch.axis);x[y].roll.axis.copy(c.roll.axis);x[y].yaw.axis.copy(c.yaw.axis);x[y].pitch.value=c.pitch.value;
x[y].roll.value=c.roll.value;x[y].yaw.value=c.yaw.value;x[y].speed=c.speed};this.debug=function(){console.log("Vehicle Timestamp:",z.TIMESTAMP);console.log("Physics:",e);console.log("lookAt:",this.lookAt);console.log("drones:",x)}}function zb(){var e=this;this.renderer=document.createElement("canvas");this.renderer.id="ui";document.body.appendChild(this.renderer);var b=this.renderer.getContext("2d");this.context=b;var l=document.createElement("img");l.src="./img/stage.font.0.0.6.3.png";l.onload=function(){e.connect();
e.onload()};document.createElement("canvas");this.onload=function(){};var k=document.createElement("canvas"),q=k.getContext("2d");this.scale=1;this.row=this.col=8;this.width;this.height;this.style=0;var x=128,n=180,E=128,B=80,y;var g=128;var c=n;var f=128;var h=80;var p=!(y={x:128,y:n+60,w:128,h:40}),w=[],H=[],L=[];this.timeouts=[];this.connect=function(){b.imageSmoothingEnabled=!1;e.format(0,"#ffffff")};this.format=function(m,A){m=void 0===m?0:m;A=void 0===A?"#ffffff":A;void 0===k[m]&&(k[m]=document.createElement("canvas"),
q[m]=k[m].getContext("2d"));q[m].drawImage(l,0,0,128,128,0,0,128,128);q[m].globalCompositeOperation="source-atop";q[m].fillStyle=A;q[m].fillRect(0,0,128,128);q[m].globalCompositeOperation="source-out"};this.resize=function(m,A,I,J){J=void 0===J?1:J;e.scale=I*J;var F=window.devicePixelRatio,ia=300>Math.ceil(F)/F*m?Math.floor(F):Math.ceil(F);0!=ia-F&&(I=ia/F*J);1>=F&&1<e.scale&&(I=e.scale);this.width=m/I;this.height=A/I;this.renderer.width=this.width;this.renderer.height=this.height;Ga.setSize(this.width,
this.height);e.scale=I;this.renderer.style.transform="scale("+I+","+I+")";Ga.domElement.style.transform="scale("+I+","+I+")";this.renderer.style.transformOrigin="top left";Ga.domElement.style.transformOrigin="top left";b.imageSmoothingEnabled=!1;this.redraw();x=128;n=180;E=128;B=80;g=128;c=n;f=128;h=80;y={x:128,y:n+60,w:128,h:40};this.automate(this.width,this.height)};this.igmode=function(){this.resize(1080,1080,1,2);this.renderer.style.left=window.innderWidth/2-540;this.renderer.style.position="fixed"};
this.update=function(m){var A=0,I;for(I in m)for(var J in L)if(m[I].x>L[J].x*e.scale&&m[I].y>L[J].y*e.scale&&m[I].x<L[J].w*e.scale&&m[I].y<L[J].h*e.scale&&(A++,1==m[I].start)){L[J].funct();m[I].start=!1;break}};this.print=function(m,A,I,J){J=void 0===J?1:J;for(var F=0,ia=e.compile(A,e.width,e.col),U=e.compile(I,e.height,e.row),W=e.style;F<m.length;)e.encode(m.charAt(F),ia+F*e.col*J,U,J),F++;p||w.push(function(){e.style=W;e.print(m,A,I,J)})};this.text=function(m,A,I,J,F){J=void 0===J?1:J;for(F=0;F<
m.length;)e.encode(m.charAt(F),A+F*e.col*J,I,J),F++};this.button=function(m,A,I,J,F,ia,U,W){U=void 0===U?!0:U;W=void 0===W?1:W;var Z=e.compile(A,e.width,e.col),qa=e.compile(I,e.height,e.row),ma=e.compile(J,e.width,e.col),Y=e.compile(F,e.height,e.row),da=e.style;U&&(b.drawImage(k[e.style],0,0,1,1,Z,qa+Y/2,ma+1,1),b.drawImage(k[e.style],0,0,1,1,Z,qa-Y/2,ma+1,1),b.drawImage(k[e.style],0,0,1,1,Z,qa-Y/2,1,Y),b.drawImage(k[e.style],0,0,1,1,Z+ma-1,qa-Y/2,1,Y+1));for(var na=0;na<m.length;)e.encode(m.charAt(na),
Z+na*e.col+ma/2-Math.round(m.length*e.col)/2+2,qa-e.row/2,W),na++;L.push({x:Z,y:qa-Y/2,w:Z+ma,h:qa+Y/2,funct:function(){ia()}});p||w.push(function(){e.style=da;e.button(m,A,I,J,F,ia,U,W)})};this.line=function(m,A,I,J){e.sprite(0,0,1,1,m,A,I,J)};this.sprite=function(m,A,I,J,F,ia,U,W){var Z=e.compile(F,e.width,e.col),qa=e.compile(ia,e.height,e.row),ma=e.compile(U,e.width,e.col),Y=e.compile(W,e.height,e.row),da=e.style;b.drawImage(k[e.style],m,A,I,J,Z,qa,ma,Y);p||w.push(function(){e.style=da;e.sprite(m,
A,I,J,F,ia,U,W)})};this.backdrop=function(m,A,I,J,F){!1===(void 0===m?"#10101099":m)?(e.clear(),e.renderer.className=""):(e.clear(),e.renderer.className="backdrop")};this.getDrawList=function(){return w};this.redraw=function(){p=!0;e.clear();for(var m=0;m<w.length;m++)w[m]();m=document.body.getElementsByTagName("input");for(var A=0;A<m.length;A++)e.text(m[A].value,m[A].style.top,m[A].style.left);p=!1};this.automate=function(m,A){m=Math.floor(m/3)-2;A=Math.floor(A/4);E>m&&(E=m,x=m,f=m,g=m,y.w=m,y.x=
m);n>A&&(n=A+40,c=n,y.y=n+60)};this.pad=function(m,A,I,J,F,ia,U){var W=0;for(U();W<M.touches.length;)M.touches[W].x>A*e.scale&&M.touches[W].y>I*e.scale&&M.touches[W].x<(A+J)*e.scale&&M.touches[W].y<(I+F)*e.scale&&ia(),W++;ab&&(b.drawImage(k[e.style],0,0,1,1,A+1,I,J-1,1),b.drawImage(k[e.style],0,0,1,1,A+1,I+F,J-1,1),b.drawImage(k[e.style],0,0,1,1,A+1,I,1,F),b.drawImage(k[e.style],0,0,1,1,A+J-1,I,1,F));e.encode(m,A+J/2-e.col/2,I+F/2-e.row/2)};this.dpad=function(){b.drawImage(k[e.style],88,88,40,40,
e.width-g+f/2-20,e.height-c+h/2-20,40,40);e.pad("<",x-E-1,e.height-n,E,B,function(){M.LEFT=!0},function(){M.LEFT=!1});e.pad(">",x+1,e.height-n,E,B,function(){M.RIGHT=!0},function(){M.RIGHT=!1});e.pad("^",e.width-g,e.height-c,f,h,function(){M.UP=!0},function(){M.UP=!1});e.pad("b",e.width-y.x,e.height-y.y+y.h/2,y.w,y.h,function(){M.DOWN=!0},function(){M.DOWN=!1})};this.clear=function(){if(!p){for(var m=document.body.getElementsByTagName("input"),A=0;A<m.length;A++)document.body.removeChild(m[A]);if(!e.REDRAW){w=
[];for(m=0;m<H.length;m++)document.body.removeChild(H[m]);H=[]}w=[];for(m=0;m<this.timeouts.length;m++)window.clearTimeout(this.timeouts[m])}L=[];b.clearRect(0,0,e.width,e.height)};this["delete"]=function(m,A,I,J){A=void 0===A?0:A;I=void 0===I?Ga.width:I;J=void 0===J?Ga.height:J;m=e.compile(void 0===m?0:m,e.width,e.col);A=e.compile(A,e.height,e.row);I=e.compile(I,e.width,e.col);J=e.compile(J,e.height,e.row);b.clearRect(m,A,I,J)};this.encode=function(m,A,I,J){J=void 0===J?1:J;var F=m.charCodeAt(0);
m=8*F%128;F=8*Math.floor(F/16);b.clearRect(A,I,8,8);b.drawImage(k[e.style],m,F,8,8,A,I,8*J,8*J)};this["float"]=function(m,A){var I=Math.floor(Math.abs(100*m));I=I.toString();var J=I.slice(0,I.length-2),F=I.slice(I.length-2,I.length);return 0==m?"0.00":(0==J.length&&(J="0"),2>F.length&&(F+="0"),A&&0<m?J="+"+J:0>m&&(J="-"+J),I=J+"."+F,I)};this.compile=function(m,A,I){var J=0;switch(A=Math.floor(A),typeof m){case "number":J=m;break;case "function":J=m();break;case "string":for(var F=!1,ia=1,U=0,W="";U<
m.length;){var Z=m.charAt(U);"."===Z?(W+=Z,F=!0):"+"===Z?(W=F?Number(W)*A:Number(W)*I,W*=ia,ia=1,J+=W,F=!1,W=""):"-"===Z?(W=F?Number(W)*A:Number(W)*I,W*=ia,ia=-1,J+=W,F=!1,W=""):"p"===Z?(W=Number(W),W*=ia,J+=W,W=""):U===m.length-1?(W+=Z,W=F?Number(W)*A:Number(W)*I,W*=ia,J+=W,W=""):W+=Z;U++}}return J};this.textinput=function(m,A,I,J,F,ia,U){var W=e.compile(A,e.width,e.col),Z=e.compile(I,e.height,e.row),qa=e.compile(J,e.width,e.col),ma=e.compile(F,e.height,e.row),Y=e.style;if(p)e.text("> "+U.value,
W,Z+ma/2);else{(U=document.createElement("input")).type="text";U.id=ia;U.name=ia;U.value=m;U.style.position="fixed";U.style.top=Z+"px";U.style.left=W+"px";U.style.width=qa+"px";U.style.height=ma+"px";U.style.paddingLeft="12px";U.style.fontSize="14px";U.style.zIndex=9999;U.style.opacity=0;U.maxlength=10;e.text("> "+U.value,W,Z+ma/2);document.body.appendChild(U);window.setTimeout(function(){U.focus();U.select()},200);U.oninput=function(){da()};U.onfocusout=function(){da()};U.onfocusin=function(){da()};
U.onclick=function(){da()};var da=function(na){e["delete"](W,Z,qa,ma);e.text("> "+U.value,W,Z+ma/2);e.text("_",U.selectionStart*e.col+2*e.col+W,Z+ma/2)};w.push(function(){e.style=Y;e.textinput(U.value,A,I,J,F,ia,U)})}};this.link=function(m,A,I,J,F,ia,U,W){var Z=e.compile(A,e.width,e.col)*e.scale,qa=e.compile(I,e.height,e.row)*e.scale,ma=e.compile(J,e.width,e.col)*e.scale,Y=e.compile(F,e.height,e.row)*e.scale,da=e.style;p||w.push(function(){return new function(){e.style=da;na.style.left=Z+"px";na.style.top=
qa+"px";na.style.width=ma+"px";na.style.height=Y+"px";e.print(m,Z,qa)}});var na=document.createElement("a");na.href=ia;na.style.left=Z+"px";na.style.top=qa+"px";na.style.width=ma+"px";na.style.height=Y+"px";na.style.display="block";na.style.zIndex=999;na.style.position="fixed";na.target="_blank";na.id=ia;document.body.appendChild(na);H.push(na);p=!0;e.print(m,Z,qa);p=!1};this.time=function(m){return(m/100).toFixed(2)};this.typewrite=function(m){e.clear();for(var A={$jscomp$loop$prop$e$147$188:0};A.$jscomp$loop$prop$e$147$188<
m.length;A={$jscomp$loop$prop$e$147$188:A.$jscomp$loop$prop$e$147$188},A.$jscomp$loop$prop$e$147$188++){var I=(A.$jscomp$loop$prop$e$147$188,0);I=Math.floor(A.$jscomp$loop$prop$e$147$188%32);var J=Math.floor(A.$jscomp$loop$prop$e$147$188/32);I=32+I%32*8;J=32+16*J;window.setTimeout(function(F){return function(){a.text(m.charAt(F.$jscomp$loop$prop$e$147$188),I,J)}}(A),50*A.$jscomp$loop$prop$e$147$188)}}}function Ab(){var e=this;this.TEXTTIME=this.SPEED="";this.RESET=this.END=this.START=!1;this.OBJECTIVE=
0;this.POSITION;this.MODEL=1;this.ANALOG=!1;this.PENALTY=function(){return h};this.CAMERA=1;this.FPV=!1;this.inputs=[];this.PHYSICSBUFFER=[];this.RAW=[];this.DISTANCE_AUDIT=[];this.SYNC=!1;this.START_POSITION=new THREE.Vector3;this.START_NORMAL=new THREE.Vector3;this.START_DIRECTION=new THREE.Vector3;this.START_VELOCITY=new THREE.Vector3;this.FRAME_TIME=this.START_ROTATION=0;this.BATCH_POSITIONS=[];this.DISCONNECT=this.IMPORT=!1;this.SAVE_PARAM={model:0,paint:0,power:0,drag:0,sensitivity:0};this.DEBUG_BUFFER=
[];this.IMPORT_BUFFER=[];this.FRAME=0;var b=[],l=0;this.TIMESTEP=Sa;var k=1;this.TIMESTAMP=0;this.REPLAY_START=this.REPLAY=!1;this.INPUTS=[];var q=new THREE.Mesh(new THREE.IcosahedronGeometry(4,0),new THREE.MeshBasicMaterial({wireframe:!0})),x=!1,n=!1,E=!1,B=!1,y=!0,g=!1;this.CHECKPOINT=[];this.VALIDATE_CHECKPOINT=[];this.best=[];var c=0,f=0,h=0,p=0,w=!1,H=!1,L=0,m=0;this.DT=function(){return 1};var A={power:2,drag:0,mass:1,brake:2,sensitivity:2,ease:0},I=0,J=0,F=0;I=.004;J=.985-.98;F=.08-.06;var ia,
U,W,Z=6,qa,ma=0,Y=0,da=0,na=new THREE.Vector3(0,1,0),Xa=new THREE.Vector3(0,0,0),Ya=new THREE.Vector3,u=new THREE.Vector3(0,5,0);new THREE.Vector3(1,0,0);var t=new THREE.Vector3(0,0,1),r=new THREE.Vector3(0,0,1),K=new THREE.Vector3(0,0,1),G=new THREE.Vector3(0,0,1),C=new THREE.Vector3(0,0,-.008),X=new THREE.Vector3,O=new THREE.Vector3,Q=new THREE.Vector3,P=new THREE.Vector3;this.position=X.clone();this.direction=na.clone();this.lookAt=X.clone();this.normal=r.clone();this.rotation=0;var V=[],ba=new THREE.Vector3(0,
0,1),ca=new THREE.Raycaster(P,ba,0,2);this.cameras=[];this.cameras[0]={distance:22,x:0,y:0,z:9,lerp:.1,lookAt:new THREE.Vector3};this.cameras[1]={distance:0,x:20,y:20,z:10,lerp:.05,lookAt:new THREE.Vector3};this.cameras[2]={distance:0,x:-20,y:-20,z:20,lerp:.05,lookAt:new THREE.Vector3};this.cameras[3]={distance:0,x:-40,y:40,z:30,lerp:.075,lookAt:new THREE.Vector3};this.cameras[4]={distance:0,x:0,y:-20,z:60,lerp:.0075,lookAt:new THREE.Vector3};var za=[{name:"logistics crate",geometry:function(){return sa.logisticscrate()}},
{name:"ag-86",geometry:function(){return sa.ag86()}},{name:"log evo",geometry:function(){return sa.logevo}},{name:"ag-sprinter",geometry:function(){return sa.agsprinter}},{name:"lts-02",geometry:function(){return sa.lts02}},{name:"crane",geometry:function(){return sa.crane}}];this.models=function(){return za};this.mesh=function(){return wa};this.PAINT=0;var Ia=new THREE.MeshBasicMaterial({color:Ra[e.PAINT]}),wa=(new THREE.LineSegments(za[e.MODEL].geometry(),Ia)).clone();wa.name="Vehicle";var eb=new sa.emitter;
this.connect=function(N,ea){wa.copy(new THREE.LineSegments(za[e.MODEL].geometry(),Ia));wa.name="Vehicle";Q.copy(N);Q.z+=2;wa.position.copy(Q);oa.add(wa);eb.connect(Ra[e.PAINT]);e.tune.power();e.tune.drag();e.tune.sensitivity();e.tune.ease();oa.fog=new THREE.FogExp2(ja[0],.005);ka.fov=90;ka.updateProjectionMatrix();oa.add(R.generate.stars);e.START_POSITION.copy(Q);e.START_NORMAL.copy(r);e.START_DIRECTION.copy(na);e.START_VELOCITY.copy(Ya);uas.TARGETS.length<fa.length+1&&uas.TARGETS.push(this);this.CHECKPOINT=
[];this.RESET=!0;this.reset()};this.disconnect=function(){this.DISCONNECT=!0;this.RESET=this.IMPORT=!1;e.reset(!1);oa.remove(wa);eb.disconnect();oa.fog=new THREE.FogExp2(ja[0],0);oa.remove(R.generate.stars);this.DISCONNECT=!1};this.ready=function(N){N=void 0===N?window.performance.now():N;var ea;!x&&!this.REPLAY||this.RESET||(R.generate.checkpoints[0].display.material.color=ja[4],uas.reset(),m=1,w=!1,H=!1,y=!0,ua.reset(),p=N,c=0,l=0,this.FRAME=0,b[l].time=0,b=[],b.length=0,l=0,b.push({time:0,position:e.START_POSITION.clone(),
normal:e.START_NORMAL.clone(),direction:e.START_DIRECTION.clone(),velocity:e.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1}),e.REPLAY?(e.DEBUG_BUFFER=[],ea={time:0,position:e.START_POSITION.clone(),direction:e.START_DIRECTION.clone(),normal:e.START_NORMAL.clone(),lookAt:G.clone(),velocity:e.START_VELOCITY.clone(),rotation:0,U:!1,D:!1,L:!1,R:!1,step:0},e.DEBUG_BUFFER.push(ea),e.DISTANCE_AUDIT=[]):(e.INPUTS=[],e.PHYSICSBUFFER=[],e.PHYSICSBUFFER.length=0,ea={},Object.assign(ea,b[l]),e.PHYSICSBUFFER.push(ea),
e.CHECKPOINT[0]=Date.now()),e.START=!0)};this.reset=function(N){N=void 0===N?!1:N;e.REPLAY=N;e.RESET=!0;Ca=!N;wa.visible=!0;Fa&&(wa.visible=!1);this.SYNC=!1;this.FRAME=this.TIMESTAMP=0;g=Ua=this.END=this.START=!1;M.UP=!1;M.DOWN=!1;M.LEFT=!1;B=E=n=x=M.RIGHT=!1;m=h=L=0;X.copy(e.START_POSITION);O.copy(X);na.copy(e.START_DIRECTION);Ya.copy(e.START_VELOCITY);r.copy(e.START_NORMAL);P.copy(X);this.position=X.clone();this.direction=na.clone();this.lookAt=X.clone();this.normal=r.clone();qa=da=ma=Y=this.rotation=
0;e.SPEED=0;ba.copy(e.START_NORMAL);ba.normalize();ca.far=ba.length();ca.set(e.START_POSITION,ba);K.copy(e.START_NORMAL);G.copy(e.START_NORMAL);G.add(e.START_POSITION);ka.updateProjectionMatrix();g=!0;eb.reset();ua.reset();uas.reset();b=[];p=l=0;this.IMPORT||(p=window.performance.now());for(N=0;N<R.generate.checkpoints.length;N++)R.generate.checkpoints[N].display.material.color=ja[5];if(b[0]={time:0,position:this.START_POSITION.clone(),normal:this.START_NORMAL.clone(),direction:this.START_DIRECTION.clone(),
velocity:this.START_VELOCITY.clone(),rotation:0,step:0,U:!1,D:!1,L:!1,R:!1},!e.REPLAY)for(this.DEBUG_BUFFER=[],c=0,this.IMPORT||(e.best=e.overwrite(e.CHECKPOINT,e.best)),R.best=e.overwrite(e.CHECKPOINT,R.best),this.CHECKPOINT=[],this.CHECKPOINT.length=6,e.inputs=[],e.inputs.push({key:0,time:0}),e.PHYSICSBUFFER=[],N={},Object.assign(N,b[l]),e.PHYSICSBUFFER.push(N),N=0;N<fa.length;N++)fa[N].reset();this.VALIDATE_CHECKPOINT=[];this.VALIDATE_CHECKPOINT.length=6;q.position.copy(e.START_POSITION);q.lookAt(G);
wa.lookAt(G);q.rotateOnAxis(t,0);H=w=!1;y=!0;this.DISTANCE_AUDIT=[];e.RESET=!1};this.update=function(N){N=void 0===N?window.performance.now():N;Ua||e.END||!g||e.REPLAY||e.RESET?(x=!1,n=!1,E=!1,B=!1):(x=M.UP,n=M.DOWN,E=M.LEFT,B=M.RIGHT,E&&B&&(E=!1,B=!1));this.START||this.ready();this.TIMESTAMP=this.IMPORT?N+99999-p:N-p;N=0;if(this.TIMESTAMP>b[l].time){var ea={};Object.assign(ea,b[l]);var ra=ea.time;b=[];l=0;for(b.push({time:ra,position:ea.position.clone(),normal:ea.normal.clone(),direction:ea.direction.clone(),
velocity:ea.velocity.clone(),rotation:ea.rotation,step:ea.step,U:ea.U,D:ea.D,L:ea.L,R:ea.R});ra<this.TIMESTAMP;){var xa;ra+=Sa;this.REPLAY&&this.START&&(N=this.tapeReplay(ra));b.push({time:ra,position:b[l].position.clone(),normal:b[l].normal.clone(),direction:b[l].direction.clone(),velocity:b[l].velocity.clone(),rotation:b[l].rotation,step:b[l].step,U:x,D:n,L:E,R:B});l=b.length-1;e.START&&(Pa=Da=void 0,Pa=E&&B?0:E?1:B?-1:0,da=b[l].step,0!=Pa&&Math.abs(da)<Z?da+=Pa:Math.abs(da)>Z?(Da=da/Math.abs(da),
da=Z*Da):0<Math.abs(da)&&(Da=da/Math.abs(da),da-=da/Math.abs(da),da/Math.abs(da)!=Da&&(da=0)),ma=da/Z*W,b[l].rotation+=ma,b[l].step=da,qa=b[l].velocity.length(),Da=void 0,x&&y&&(Xa.copy(b[l].direction),Xa.multiplyScalar(ia),b[l].velocity.add(Xa)),n&&y&&b[l].velocity.multiplyScalar(.95),y?(H=!1,Da=w?U-.01:U,b[l].velocity.multiplyScalar(Da)):y||(H?b[l].velocity.add(C):H=!0,b[l].velocity.multiplyScalar(.998)),b[l].position.add(b[l].velocity),q.position.copy(b[l].position),function(){V=[];P.copy(b[l].position);
P.z-=50;ba.set(0,0,1);ca.far=100;ca.set(P,ba);R.surface.raycast(ca,V);0<V.length?(P.copy(V[0].point),w=b[l].position.z<P.z&&5>Math.abs(b[l].position.z-P.z)?(f=0,y=!0,r.copy(V[0].face.normal),b[l].position.copy(P),1!==V[0].face.color.r):y=!1):0===V.length&&(y=!1,w=!1,x||n||E||B||e.REPLAY||(f+=Sa),1E3<f&&!e.END&&!Ua&&(Ua=!0,T.dnf()));var Ba=H?.001:.25;K.copy(b[l].normal);K.lerp(r,Ba);Ba=K.clone();Ba.add(b[l].position);b[l].normal=K.clone();q.lookAt(Ba);q.rotateOnAxis(t,b[l].rotation);na.copy(q.localToWorld(u.clone()));
na.sub(b[l].position);na.normalize();b[l].direction.copy(na)}(),function(){V=[];ba.copy(b[l].position);ba.sub(b[l-1].position);ba.normalize();ca.far=ba.length();ca.set(b[l].position,ba);for(var Ba=0,Ea=!1,Ha=m;5>Ha;Ha++)if(R.generate.checkpoints[Ha].collision.raycast(ca,V),0<V.length){Ba=Ha;Ea=!0;break}if(Ea){Ha=b[l].position;Ea=V[0].point;var Ta=b[l-1].position.distanceTo(Ea);Ea=Ha.distanceTo(Ea);Ea=b[l-1].time+Ta/(Ta+Ea)*e.TIMESTEP;R.generate.checkpoints[Ba].display.material.color=ja[4];e.CHECKPOINT[Ba]=
Math.floor(Ea/10);Ea=m!==Ba;e.CHECKPOINT[5]=0;for(Ha=1;Ha<Ba;Ha++)void 0===e.CHECKPOINT[Ha]&&--e.CHECKPOINT[5];m=Ba+1;4<=Ba&&!e.REPLAY?(e.END=!0,e.REPLAY||T.complete()):e.REPLAY||e.IMPORT||T.checkpoint(Ea)}e.SPEED=Math.round(60*qa/1E3*3600);e.START&&!e.END&&(c=Math.floor(b[l].time/10));e.OBJECTIVE=m;O.copy(X)}());this.FRAME++;this.START&&!this.REPLAY?(xa={},Object.assign(xa,b[l]),this.PHYSICSBUFFER.push(xa)):this.REPLAY&&N<this.PHYSICSBUFFER.length-1&&!this.RESET||this.REPLAY&&(xa={time:b[l].time,
position:b[l].position.clone(),direction:b[l].direction.clone(),normal:b[l].normal.clone(),velocity:b[l].velocity.clone(),rotation:b[l].rotation,U:b[l].U,D:b[l].D,L:b[l].L,R:b[l].R,step:b[l].step,lookAt:G.clone()},e.DEBUG_BUFFER.push(xa));!this.IMPORT&&5E3<this.TIMESTAMP-ra&&z.reset(this.REPLAY)}}var Da,Pa;if(k=(Sa-(b[l].time-this.TIMESTAMP))/Sa,1<b.length)this.position.copy(b[l-1].position),this.position.lerp(b[l].position,k),this.direction.copy(b[l-1].direction),this.direction.lerp(b[l].direction,
k),this.rotation=b[l].rotation,this.rotation-=b[l-1].rotation,this.rotation*=k,this.rotation+=b[l].rotation,this.lookAt.copy(this.position),this.normal.copy(b[l-1].normal),this.normal.lerp(b[l].normal,k),this.lookAt.copy(b[l].position),this.normal.copy(b[l].normal),xa=this.normal.clone(),xa.add(this.position),wa.position.copy(this.position),wa.lookAt(xa),wa.rotateOnAxis(t,this.rotation),eb.update(x,this.position,this.direction,qa);e.REPLAY_START&&e.replay();this.DISCONNECT?e.disconnect():e.RESET&&
e.reset(e.REPLAY)};this.results=function(){return{reward:L,yen:0}};this.AT=function(){return c};this.convert=function(N){for(var ea=[],ra=0;ra<N.length;ra++){var xa=N[ra].U,Da=N[ra].D,Pa=N[ra].L,Ba=N[ra].R,Ea=xa&&Da&&Pa,Ha=xa&&Da&&Ba,Ta=0;Ea||Ha?Ea?Ta="a":Ha&&(Ta="b"):(Ta+=xa?3:Da?6:0,Ta+=Pa?1:Ba?2:0);ea.push(Ta.toString())}return ea};this.replay=function(N){e.REPLAY_START?(0===e.INPUTS.length&&(e.INPUTS=e.PHYSICSBUFFER.slice()),Ca=!1,e.REPLAY=!0,e.REPLAY_START=!1,e.RESET=!0):e.REPLAY_START=!0};this.desyncTune=
function(N,ea){void 0===N||N?(e.SAVE_PARAM.power=ea.power,e.SAVE_PARAM.drag=ea.drag,e.SAVE_PARAM.sensitivity=ea.sensitivity,e.SAVE_PARAM.model=ea.model,e.SAVE_PARAM.paint=ea.paint):(e.PAINT=e.SAVE_PARAM.paint,e.MODEL=e.SAVE_PARAM.model,e.paint(),e.body(),e.tune.power(e.SAVE_PARAM.power),e.tune.drag(e.SAVE_PARAM.drag),e.tune.sensitivity(e.SAVE_PARAM.sensitivity))};this["import"]=function(){var N=fa.length+" / "+T.BATTLE.length;0===fa.length&&(e.SAVE_PARAM.power=e.param().power,e.SAVE_PARAM.drag=e.param().drag,
e.SAVE_PARAM.sensitivity=e.param().sensitivity,e.SAVE_PARAM.model=e.MODEL,e.SAVE_PARAM.paint=e.PAINT);fa.length<T.BATTLE.length?(T.scan(N,!1),this.reset(),e.PAINT=T.BATTLE[fa.length].param.paint,e.MODEL=T.BATTLE[fa.length].param.model,e.paint(),e.body(),e.tune.power(T.BATTLE[fa.length].param.power),e.tune.drag(T.BATTLE[fa.length].param.drag),e.tune.sensitivity(T.BATTLE[fa.length].param.sensitivity),e.INPUTS=T.BATTLE[fa.length].data,this.IMPORT=!0,this.REPLAY_START=!0,this.RESET=!0,this.reset(),e.replay()):
(b[l].time=0,this.IMPORT=!1,Fa?(this.RESET=!0,this.reset(),this.REPLAY_START=!0,e.replay(),uas.spectate(),T.replay("import"),this.INPUTS=[]):(this.reset(!1),T.play()),e.PAINT=e.SAVE_PARAM.paint,e.MODEL=e.SAVE_PARAM.model,e.paint(),e.body(),e.tune.power(e.SAVE_PARAM.power),e.tune.drag(e.SAVE_PARAM.drag),e.tune.sensitivity(e.SAVE_PARAM.sensitivity))};this.tune={power:function(N){N=void 0===N?A.power:N;A.power=0>N?0:5<N?5:N;ia=.016+A.power/5*I},drag:function(N){N=void 0===N?A.drag:N;A.drag=0>N?0:5<N?
5:N;U=.985-A.drag/5*J},sensitivity:function(N){N=void 0===N?A.sensitivity:N;A.sensitivity=0>N?0:5<N?5:N;W=.06+A.sensitivity/5*F},ease:function(N){N=void 0===N?A.ease:N;A.ease=0>N?0:5<N?5:N;Z=6+A.ease}};this.param=function(){return array=Object.assign(A,[]),array.model=e.MODEL,array.paint=e.PAINT,array};this.paint=function(N){N=void 0===N?e.PAINT:N;e.PAINT=N;eb.paint(Ra[N]);Ia.color.set(Ra[N]);Ia.needsUpdate=!0};this.body=function(){wa.geometry.dispose();wa.geometry=za[e.MODEL].geometry().clone();
wa.geometry.verticesNeedUpdate=!0};this.yen=function(){return T.cSave("YEN",0),0};this.debug=function(){console.log("position:",X);console.log("direction:",na);console.log("rotation:",Y);console.log("dt:",1);console.log("TIME:",cb);console.log("INTERPOLATION:",k);console.log("PHYSICS MESH:",q.rotation);console.log("EASE",Z);console.log(b);console.log(f);console.log("TIMESTAMPS",this.TIMESTAMP);console.log("KEYBUFFER",this.inputs[this.inputs.length-1]);console.log("PHYSICS",b[l]);console.log("PHYSICSBUFFER",
this.PHYSICSBUFFER)};this.tapeReplay=function(N){var ea=0;if(0==e.INPUTS.length)ea=0;else if(N<e.INPUTS[e.INPUTS.length-1].time){for(;e.INPUTS[ea].time<N;)ea++;x=this.INPUTS[ea].U;n=this.INPUTS[ea].D;E=this.INPUTS[ea].L;B=this.INPUTS[ea].R}else if(this.IMPORT){N=!0;for(var ra="",xa=1;xa<this.CHECKPOINT.length;xa++)this.CHECKPOINT[xa]!==T.BATTLE[fa.length].cp[xa]&&(""===ra&&(ra+="checkpoint_discrepancy"),N=!1);if(e.CHECKPOINT[4]-1E4*e.CHECKPOINT[5]!==T.BATTLE[fa.length].time&&(N=!1,ra+="final_time_discrepancy"),
N||!N){N=[];for(ra=0;ra<this.DEBUG_BUFFER.length;ra++)N.push({time:this.DEBUG_BUFFER[ra].time,position:this.DEBUG_BUFFER[ra].position.clone(),direction:this.DEBUG_BUFFER[ra].direction.clone(),rotation:this.DEBUG_BUFFER[ra].rotation,normal:this.DEBUG_BUFFER[ra].normal.clone(),lookAt:this.DEBUG_BUFFER[ra].lookAt.clone(),U:this.DEBUG_BUFFER[ra].U});fa.push(new pb(N,this.MODEL,this.PAINT,this.CHECKPOINT.slice(),T.BATTLE[fa.length].name))}else firebase.analytics().logEvent("invalid_data "+T.BATTLE[fa.length].name+
"/"+T.BATTLE[fa.length].uid,{seed:R.name,uid:T.BATTLE[fa.length].uid,name:T.BATTLE[fa.length].name,report:R.name+"/"+T.BATTLE[fa.length].uid+"("+T.BATTLE[fa.length].name+")"+ra+" : "+la+"/("+pa+")",error:ra});this["import"]()}else e.replay(!1),this.START=this.IMPORT=!1;return ea};this.overwrite=function(N,ea,ra){ra=void 0===ra?!0:ra;var xa=N[4]<ea[4],Da=N[5]>=ea[5],Pa=N[5]>ea[5];return void 0===ea[4]||xa&&Da||Pa?!ra||N:!!ra&&ea};this.decode=function(N){var ea=[function(){M.UP=!1;M.DOWN=!1;M.LEFT=
!1;M.RIGHT=!1},function(){M.UP=!1;M.DOWN=!1;M.LEFT=!0;M.RIGHT=!1},function(){M.UP=!1;M.DOWN=!1;M.LEFT=!1;M.RIGHT=!0},function(){M.UP=!0;M.DOWN=!1;M.LEFT=!1;M.RIGHT=!1},function(){M.UP=!0;M.DOWN=!1;M.LEFT=!0;M.RIGHT=!1},function(){M.UP=!0;M.DOWN=!1;M.LEFT=!1;M.RIGHT=!0},function(){M.UP=!1;M.DOWN=!0;M.LEFT=!1;M.RIGHT=!1},function(){M.UP=!1;M.DOWN=!0;M.LEFT=!0;M.RIGHT=!1},function(){M.UP=!1;M.DOWN=!0;M.LEFT=!1;M.RIGHT=!0},function(){M.UP=!0;M.DOWN=!0;M.LEFT=!1;M.RIGHT=!1}];ea.a=function(){M.UP=!0;M.DOWN=
!0;M.LEFT=!0;M.RIGHT=!1};ea.b=function(){M.UP=!0;M.DOWN=!0;M.LEFT=!1;M.RIGHT=!0};ea[N]()};this.audit=function(){}}function Bb(e){var b=this;this.PLAY=!1;this.RECORD=!0;this.tape=[];this.timer=this.frame=0;this.AT=function(){return b.tape[l].timer};this.DT=mb();var l=0;this.keybuffer=[];this.SCAN=!1;this.inputCapture=function(k){this.keybuffer.push({key:(M.UP?3:M.DOWN?6:0)+(M.LEFT?1:M.RIGHT?2:0),time:k})};this.simulate=function(){};this.capture=function(k){return{position:(new THREE.Vector3).copy(k.position),
normal:(new THREE.Vector3).copy(k.normal),lookTarget:k.lookTarget.clone(),rotation:k.rotation,timer:k.getTime(),objective:k.getObjective(),check:k.check,UP:k.UP}};this.record=function(k){b.tape[l]=k.record();l=24E4<b.tape[l].TS?0:l+1};this.play=function(k){if(this.RECORD){this.RECORD=!1;for(var q=b.frame=0;q<fa.length;q++)fa[q].reset();ua.reset()}if(b.frame>b.tape.length-10){b.frame=0;ua.reset();for(q=0;q<fa.length;q++)fa[q].reset();R.generate.resetCheckpoints()}if(k.replay(),this.tape[b.frame].check)R.generate.checkpoints[0===
this.tape[b.frame].objective?4:this.tape[b.frame].objective-1].display.material.color=ja[4]};this.reset=function(){R.generate.resetCheckpoints();l=0;b.frame=0;ua.reset();b.PLAY=!1;b.RECORD=!0;b.tape=[]};this["export"]=function(k,q){k=void 0===k?function(){T.results()}:k;var x=z.CHECKPOINT[4]-1E4*z.CHECKPOINT[5];if((x<Wa||!1===Wa)&&""!==pa&&null!==pa&&!1!==la&&void 0!==la&&!b.SCAN||void 0!==q&&!q){T.STATE=function(){a.clear();a.print("uploading vhs to db","2","2")};T.STATE();la;var n=R.name,E=z.CHECKPOINT.slice(),
B=z.CHECKPOINT[0],y=z.param();q=0<Aa;for(var g=[];g.length<z.PHYSICSBUFFER.length;){var c=g.length;c={time:z.PHYSICSBUFFER[c].time,U:z.PHYSICSBUFFER[c].U,D:z.PHYSICSBUFFER[c].D,L:z.PHYSICSBUFFER[c].L,R:z.PHYSICSBUFFER[c].R};g.push(c)}q={version:"006",id:la,seed:n,time:x,cp:E,utc:B,debug:g,param:y,boost:q};console.log(q);firebase.database().ref("vhs/006/"+q.seed+"/"+la).set(q,function(f){f?(a.clear(),a.print("network error","2","2")):(a.clear(),a.print("vhs succesfully submitted","2","2"));window.setTimeout(k,
1E3);uas.replay();z.replay()})}else void 0===la||!1===la||null===pa||""===pa||void 0===pa?T.register():(T.results(),uas.replay(),z.replay())};this.burn=function(k){return Math.round(1E9*k).toString(16)};this.read=function(k){return parseInt(k,16)/1E9};this.scan=function(k,q){b.SCAN=!0;var x=[];firebase.database().ref("vhs/006/"+k).orderByChild("time").limitToFirst(99).once("value").then(function(n){n.forEach(function(E){var B=E.child("id").val(),y=E.child("time").val(),g=E.child("utc").val();E=E.child("boost").val();
x.push({uid:B,time:y,utc:g,boost:E})});b.SCAN=!1;q(x)})};this.checkTime=function(k,q,x){k===q&&(Wa=x)};this.requestName=function(k,q){firebase.database().ref("uid/"+k).once("value").then(function(x){x=x.child("name").val();return q(x),x})};this["import"]=function(k,q){q=void 0===q?function(){}:q;firebase.database().ref("vhs/006/"+k).once("value").then(function(x){var n=x.val(),E=n.id,B=n.seed,y=n.cp.slice(),g=n.utc;x=(n.model,n.paint,n.param,void 0!==n.boost);q({uid:E,seed:B,cp:y,utc:g,debug:n.debug.slice(),
param:n.param,boost:x})})};this.save=function(k,q){q=void 0===q?1E3/30:q;for(var x=0,n=[],E=k[k.length-1].TS,B=0;B<E;)B+=q,B<E&&n.push({TS:B});for(E=0;E<n.length;E++)x=b.convert(k,n[E],x);return n};this.convert=function(k,q,x){for(var n=k[x].time,E=k[x+1].TS,B=E-n;q.time>E&&x<k.length-2;)n=k[++x].time,E=k[x+1].time,B=E-n;n=x;var y=x+1;E=(B-(E-q.time))/B;return q.position=new THREE.Vector3,q.position.copy(k[n].position),q.position.lerp(k[y].position,E),q.lookTarget=new THREE.Vector3,q.lookTarget.copy(k[n].normal),
q.lookTarget.lerp(k[y].normal,E),q.rotation=(k[y].rotation-k[n].rotation)*E,q.rotation+=k[n].rotation,q.rotation=(k[y].rotation-k[n].rotation)*E,q.rotation+=k[n].rotation,q.AT=(k[y].AT-k[n].AT)*E,q.AT+=k[n].AT,q.UP=k[n].UP,q.check=k[n].check,q.objective=k[n].objective,x}}var pb=function(e,b,l,k,q){b=void 0===b?0:b;l=void 0===l?0:l;k=void 0===k?[]:k;q=void 0===q?"":q;var x=z.models().slice();this.inputs=[];this.name=q;this.cp=k;q=b;b=l;var n=e.slice();this.PHYSICS=n;var E=0,B=new THREE.Vector3(0,0,
1);n[0].position.clone();new THREE.Vector3;new THREE.Vector3(0,0,1);new THREE.Vector3;new THREE.Vector3;new THREE.Vector3(0,5,0);this.position=new THREE.Vector3;this.direction=new THREE.Vector3;this.lookAt=new THREE.Vector3;this.normal=new THREE.Vector3;this.velocity=new THREE.Vector3;var y=x[q].geometry(),g=new THREE.MeshBasicMaterial({color:Ra[b]}),c=new THREE.LineSegments(y,g);c.visible=!0;c.name="ghost_"+fa.length;c.position.copy(n[0].position);oa.add(c);var f=new sa.emitter;f.connect(Ra[l]);
0===R.best.length||k[4]<R.best[4]&&(k[5],R.best[5]);uas.TARGETS.push(this);Fa&&(uas.TARGET=1);this.reset=function(){ua.reset();f.reset();E=0};this.update=function(h){this.index(h);var p=(1E3/60-(n[E].time-h))/(1E3/60),w=n[E].U;0!==E&&0!==h||(E=1,p=0,w=!1);h=this.velocity.length();f.update(w,this.position,this.direction,h);h=this.normal.clone();h.add(this.position);c.position.copy(this.position);c.lookAt(h);c.rotateOnAxis(B,this.rotation);this.interpolate(p);this.lookAt.copy(this.position);this.velocity.copy(n[E].position);
this.velocity.sub(n[E-1].position)};this.interpolate=function(h){this.position.copy(n[E-1].position);this.position.lerp(n[E].position,h);this.normal.copy(n[E-1].normal);this.normal.lerp(n[E].normal,h);this.rotation=n[E].rotation;this.rotation-=n[E-1].rotation;this.rotation*=h;this.rotation+=n[E].rotation;this.direction.copy(n[E-1].direction);this.direction.lerp(n[E].direction,h)};this.discrete=function(){this.position.copy(n[E].position);this.rotation=n[E].rotation;this.normal.copy(n[E].normal)};
this.index=function(h){if(E=0,h<=n[n.length-2].time)for(;n[E].time<=h;)E++;else E=n.length-2};this.toggleEmitter=function(h){void 0===h||h?f.connect():f.disconnect()};this.disconnect=function(){oa.remove(c);y.dispose();g.dispose();f.disconnect()};this.debug=function(){console.log(n)};this.hide=function(){c.visible=!1};this.show=function(){c.visible=!0}};window.onload=function(){window.addEventListener("touchstart",aa);window.addEventListener("contextmenu",function(){});oa=new THREE.Scene;oa.background=
sb;tb=new THREE.Vector3(0,0,1);ka=new THREE.PerspectiveCamera;ka.up=tb;ka.position.z=2E3;ka.lookAt(0,0,0);ka.fov=70;ka.near=1E-5;ka.far=3E3;ka.name="Camera";oa.add(ka);Ga=new THREE.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!1,precision:"highp"});Ga.setClearColor(sb);Ga.domElement.id="renderer";Ga.setSize(document.innerWidth,document.innerHeight);document.body.appendChild(Ga.domElement);M=new D;M.connect();a=new zb;R=new Ka;z=new Ab;ya=new Bb;T=new Qa;T.login();T.checksave();T.decodeURL();
uas=new yb;uas.connect();sa.init();a.onload=function(){a.format(1,"#50ffae");a.format(2,"#999999");a.format(3,"#75e8ff");a.format(4,"#ff7272");a.format(5,"#eeeeee");a.format(6,"#DA4DFA");a.format(7,"#FF56E4");ka.position.set(0,25,10);ka.lookAt(0,0,0);ha();ta();T.intro()}};window.onresize=ha;window.fullscreenchange=ha;window.focus=ha;var lb=["development mountain","development forest"],ja=[1052688,16777215,12698049,2894892,5308334,16740978,2393855,2201343,3424820,2201152,7168071,10066329,16756970],
jb;for(jb in ja){var Cb=new THREE.Color(ja[jb]);ja[jb]=Cb}var Ra=[16777215,16760825,12910564,16758197,16383882,14267903,7727359],wb="snow sakura melon peach bumblebee lavender ice".split(" "),Wa=!1,bb="",Za=Math.floor(2147483647*Math.random()),kb="",oa,ka,Ga,R,z,M,a,ya,T,fa=[],Sa=1E3/60,Ma=10,Ja=9,Na=0,fb=!0,rb=!1,ib=!1,la=null,pa="",tb,Ca=!1,sb=ja[0],vb=0,Ua=!1,$a=!1,va=!1,hb=!1,Oa=!1,ab=!0,cb=0,db=!1,gb=!1,Fa=!1,ob=!1,nb=!1,qb=!1,Aa=!1,Va=!1,La=1;firebase.initializeApp({apiKey:"AIzaSyDQlCRzniSaIJ03IpGQ7RAp-1vBIDpEQ5M",
authDomain:"ssio-dev.firebaseapp.com",databaseURL:"https://ssio-dev-default-rtdb.firebaseio.com",projectId:"ssio-dev",storageBucket:"ssio-dev.appspot.com",messagingSenderId:"123980893844",appId:"1:123980893844:web:64ca21866527de8f302e81",measurementId:"G-DHDBDG52Q7"});firebase.analytics();var sa={ag86:function(){geometry=new THREE.Geometry;return geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.45,
-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.3,1.2,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.3,
1.2,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-.75,1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),
geometry.vertices.push(new THREE.Vector3(.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(1,-.75,-.1)),geometry.vertices.push(new THREE.Vector3(-.45,-1.4,.4)),geometry.vertices.push(new THREE.Vector3(-1,-.75,-.1)),geometry.center(),geometry.name="AG-86",geometry},logisticscrate:function(){var e=(new THREE.Geometry).fromBufferGeometry(new THREE.EdgesGeometry(new THREE.BoxGeometry(1,2,1)));return e.name="Logistics Crate",e},obj:function(e,b,l){(new THREE.OBJLoader).load(e,function(k){console.log(k.children);
for(var q=0;q<k.children.length;q++){var x=new THREE.EdgesGeometry(k.children[q].geometry,1),n=new THREE.MeshBasicMaterial({color:16777215});new THREE.LineSegments(x,n);b.copy(x)}},function(k){console.log(k.loaded/k.total*100+"% loaded")},function(k){console.log("An error happened")})},init:function(){sa.logevo=new THREE.BufferGeometry;sa.agsprinter=new THREE.BufferGeometry;sa.lts02=new THREE.BufferGeometry;sa.crane=new THREE.BufferGeometry;sa.obj("./obj/logevo.obj",sa.logevo);sa.obj("./obj/agsprinter.obj",
sa.agsprinter);sa.obj("./obj/lts02.obj",sa.lts02);sa.obj("./obj/crane.obj",sa.crane)},emitter:function(){var e=this;this.maxLife=100;for(var b=0,l=new THREE.Geometry;l.vertices.length<e.maxLife;){var k=new THREE.Vector3(0,0,0);k.life=0;k.maxLife=e.maxLife;k.acc=new THREE.Vector3(0,0,0);l.vertices.push(k);k=new THREE.Color(4294967040);l.colors.push(k)}l.verticesNeedUpdate=!0;var q=new THREE.Points(l,new THREE.PointsMaterial({size:.2,vertexColors:THREE.VertexColors,blending:THREE.AdditiveBlending,transparent:!0}));
q.name="Emitter";var x=new THREE.Color;e.connect=function(n){n=void 0===n?16777215:n;oa.add(q);e.paint(n)};e.paint=function(n){n=new THREE.Color(void 0===n?16777215:n);x=new THREE.Color;n.getHSL(x);for(n=0;n<q.geometry.vertices.length;n++)q.geometry.colors[n].setHSL(x.h,x.s,0),q.geometry.vertices[n].life=0};e.reset=function(){for(var n=0;n<q.geometry.colors.length;n++)q.geometry.colors[n].setHSL(x.h,x.s,0),q.geometry.vertices[n].life=0};e.disconnect=function(){oa.remove(q);q.geometry.dispose();q.material.dispose()};
e.update=function(n,E,B,y){if(n)for(n=0;1>n;){q.geometry.vertices[b].copy(B);q.geometry.vertices[b].multiplyScalar(-1-Math.random()*y);q.geometry.vertices[b].add(E);q.geometry.vertices[b].life=q.geometry.vertices[b].maxLife;Math.random();Math.random();Math.random();var g=.1*-Math.random();q.geometry.vertices[b].acc.copy(B);q.geometry.vertices[b].acc.multiplyScalar(g);b++;b%=q.geometry.vertices.length;n++}for(var c in q.geometry.vertices){var f;0<q.geometry.vertices[c].life&&(q.geometry.vertices[c].add(q.geometry.vertices[c].acc),
--q.geometry.vertices[c].life,f=q.geometry.vertices[c].life/100,q.geometry.colors[c].setHSL(x.h,x.s,x.l*f));0>=q.geometry.vertices[c].life&&(q.geometry.vertices[c].set(0,0,0),q.geometry.vertices[b].acc.x=0,q.geometry.vertices[b].acc.y=0,q.geometry.vertices[b].acc.z=0)}q.geometry.verticesNeedUpdate=!0;q.geometry.colorsNeedUpdate=!0;q.geometry.computeBoundingSphere()};sa["import"]=function(){document.addEventListener("dragover",function(n){n.preventDefault();n.dataTransfer.dropEffect="copy"},!1);document.addEventListener("drop",
function(n){n.preventDefault();sa.loadFiles(n.dataTransfer.files)},!1)};sa["import"]();sa.loadFiles=function(n){if(va=!0,a.clear(),a.print("loading .obj...","2","2"),0<n.length){var E=function(g){for(var c={},f=0;f<g.length;f++){var h=g[f];c[h.name]=h}return c}(n),B=new THREE.LoadingManager;B.setURLModifier(function(g){var c=E[g];return c?(console.log("Loading",g),URL.createObjectURL(c)):g});for(var y=0;y<n.length;y++)sa.loadFile(n[y],B)}};sa.loadFile=function(n,E){var B=n.name,y=B.split(".").pop().toLowerCase(),
g=new FileReader;g.addEventListener("progress",function(c){var f="("+Math.floor(c.total/1E3)+" KB)";c=Math.floor(c.loaded/c.total*100)+"%";console.log("Loading",B,f,c)});"obj"===y&&(g.addEventListener("load",function(c){T.STATE();c=c.target.result;c=(new THREE.OBJLoader).parse(c);c.name=B;z.mesh().geometry.copy(new THREE.EdgesGeometry(c.children[0].geometry))},!1),g.readAsText(n))}}},ub=function(){function e(x){return x*x*x*(x*(6*x-15)+10)}function b(x,n,E){return n+x*(E-n)}function l(x,n,E,B){var y=
15&x;x=8>y?n:E;B=4>y?E:12==y||14==y?n:B;return(0==(1&y)?x:-x)+(0==(2&y)?B:-B)}for(var k=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,
159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],
q=0;256>q;q++)k[256+q]=k[q];return{noise:function(x,n,E){var B=Math.floor(x),y=Math.floor(n),g=Math.floor(E),c=255&B,f=255&y,h=255&g,p=(x-=B)-1,w=(n-=y)-1,H=(E-=g)-1,L=e(x),m=e(n);B=e(E);y=k[c]+f;g=k[y]+h;y=k[y+1]+h;c=k[1+c]+f;f=k[c]+h;h=k[c+1]+h;return b(B,b(m,b(L,l(k[g],x,n,E),l(k[f],p,n,E)),b(L,l(k[y],x,w,E),l(k[h],p,w,E))),b(m,b(L,l(k[g+1],x,n,H),l(k[f+1],p,n,E-1)),b(L,l(k[y+1],x,w,H),l(k[h+1],p,w,H))))}}};THREE.OBJLoader=function(){function e(){var c={objects:[],object:{},vertices:[],normals:[],
colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(f,h){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=f,void(this.object.fromDeclaration=!1!==h);var p=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0);this.object={name:f||"",fromDeclaration:!1!==h,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],
smooth:!0,startMaterial:function(w,H){var L=this._finalize(!1);L&&(L.inherited||0>=L.groupCount)&&this.materials.splice(L.index,1);L={index:this.materials.length,name:w||"",mtllib:Array.isArray(H)&&0<H.length?H[H.length-1]:"",smooth:(void 0!==L?L:this).smooth,groupStart:void 0!==L?L.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(m){m={index:"number"==typeof m?m:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return m.clone=
this.clone.bind(m),m}};return this.materials.push(L),L},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(w){var H=this.currentMaterial();if(H&&-1===H.groupEnd&&(H.groupEnd=this.geometry.vertices.length/3,H.groupCount=H.groupEnd-H.groupStart,H.inherited=!1),w&&1<this.materials.length)for(var L=this.materials.length-1;0<=L;L--)0>=this.materials[L].groupCount&&this.materials.splice(L,1);return w&&0===this.materials.length&&this.materials.push({name:"",
smooth:this.smooth}),H}};p&&p.name&&"function"==typeof p.clone&&((p=p.clone(0)).inherited=!0,this.object.materials.push(p));this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(f,h){f=parseInt(f,10);return 3*(0<=f?f-1:f+h/3)},parseNormalIndex:function(f,h){f=parseInt(f,10);return 3*(0<=f?f-1:f+h/3)},parseUVIndex:function(f,h){f=parseInt(f,10);return 2*(0<=f?f-1:f+h/2)},addVertex:function(f,h,
p){var w=this.vertices,H=this.object.geometry.vertices;H.push(w[f+0],w[f+1],w[f+2]);H.push(w[h+0],w[h+1],w[h+2]);H.push(w[p+0],w[p+1],w[p+2])},addVertexPoint:function(f){var h=this.vertices;this.object.geometry.vertices.push(h[f+0],h[f+1],h[f+2])},addVertexLine:function(f){var h=this.vertices;this.object.geometry.vertices.push(h[f+0],h[f+1],h[f+2])},addNormal:function(f,h,p){var w=this.normals,H=this.object.geometry.normals;H.push(w[f+0],w[f+1],w[f+2]);H.push(w[h+0],w[h+1],w[h+2]);H.push(w[p+0],w[p+
1],w[p+2])},addFaceNormal:function(f,h,p){var w=this.vertices,H=this.object.geometry.normals;n.fromArray(w,f);E.fromArray(w,h);B.fromArray(w,p);g.subVectors(B,E);y.subVectors(n,E);g.cross(y);g.normalize();H.push(g.x,g.y,g.z);H.push(g.x,g.y,g.z);H.push(g.x,g.y,g.z)},addColor:function(f,h,p){var w=this.colors,H=this.object.geometry.colors;void 0!==w[f]&&H.push(w[f+0],w[f+1],w[f+2]);void 0!==w[h]&&H.push(w[h+0],w[h+1],w[h+2]);void 0!==w[p]&&H.push(w[p+0],w[p+1],w[p+2])},addUV:function(f,h,p){var w=this.uvs,
H=this.object.geometry.uvs;H.push(w[f+0],w[f+1]);H.push(w[h+0],w[h+1]);H.push(w[p+0],w[p+1])},addDefaultUV:function(){var f=this.object.geometry.uvs;f.push(0,0);f.push(0,0);f.push(0,0)},addUVLine:function(f){var h=this.uvs;this.object.geometry.uvs.push(h[f+0],h[f+1])},addFace:function(f,h,p,w,H,L,m,A,I){var J,F=this.vertices.length;f=this.parseVertexIndex(f,F);h=this.parseVertexIndex(h,F);F=this.parseVertexIndex(p,F);this.addVertex(f,h,F);this.addColor(f,h,F);void 0!==m&&""!==m?(J=this.normals.length,
f=this.parseNormalIndex(m,J),h=this.parseNormalIndex(A,J),F=this.parseNormalIndex(I,J),this.addNormal(f,h,F)):this.addFaceNormal(f,h,F);void 0!==w&&""!==w?(J=this.uvs.length,f=this.parseUVIndex(w,J),h=this.parseUVIndex(H,J),F=this.parseUVIndex(L,J),this.addUV(f,h,F),this.object.geometry.hasUVIndices=!0):this.addDefaultUV()},addPointGeometry:function(f){this.object.geometry.type="Points";for(var h=this.vertices.length,p=0,w=f.length;p<w;p++)this.addVertexPoint(this.parseVertexIndex(f[p],h))},addLineGeometry:function(f,
h){this.object.geometry.type="Line";for(var p=this.vertices.length,w=this.uvs.length,H=0,L=f.length;H<L;H++)this.addVertexLine(this.parseVertexIndex(f[H],p));p=0;for(L=h.length;p<L;p++)this.addUVLine(this.parseUVIndex(h[p],w))}};return c.startObject("",!1),c}function b(c){THREE.Loader.call(this,c);this.materials=null}var l=/^[og]\s*(.+)?/,k=/^mtllib /,q=/^usemtl /,x=/^usemap /,n=new THREE.Vector3,E=new THREE.Vector3,B=new THREE.Vector3,y=new THREE.Vector3,g=new THREE.Vector3;return b.prototype=Object.assign(Object.create(THREE.Loader.prototype),
{constructor:b,load:function(c,f,h,p){var w=this,H=new THREE.FileLoader(this.manager);H.setPath(this.path);H.setRequestHeader(this.requestHeader);H.setWithCredentials(this.withCredentials);H.load(c,function(L){try{f(w.parse(L))}catch(m){p?p(m):console.error(m),w.manager.itemError(c)}},h,p)},setMaterials:function(c){return this.materials=c,this},parse:function(c){var f=new e;-1!==c.indexOf("\r\n")&&(c=c.replace(/\r\n/g,"\n"));-1!==c.indexOf("\\\n")&&(c=c.replace(/\\\n/g,""));var h,p,w,H,L=c.split("\n"),
m="",A=[],I="function"==typeof"".trimLeft;c=0;for(var J=L.length;c<J;c++)if(m=L[c],m=I?m.trimLeft():m.trim(),p=m.length,0!==p&&"#"!==(h=m.charAt(0)))if("v"===h){var F=m.split(/\s+/);switch(F[0]){case "v":f.vertices.push(parseFloat(F[1]),parseFloat(F[2]),parseFloat(F[3]));7<=F.length?f.colors.push(parseFloat(F[4]),parseFloat(F[5]),parseFloat(F[6])):f.colors.push(void 0,void 0,void 0);break;case "vn":f.normals.push(parseFloat(F[1]),parseFloat(F[2]),parseFloat(F[3]));break;case "vt":f.uvs.push(parseFloat(F[1]),
parseFloat(F[2]))}}else if("f"===h){var ia=m.substr(1).trim().split(/\s+/);F=[];for(var U=0,W=ia.length;U<W;U++){var Z=ia[U];0<Z.length&&(Z=Z.split("/"),F.push(Z))}ia=F[0];U=1;for(W=F.length-1;U<W;U++){Z=F[U];var qa=F[U+1];f.addFace(ia[0],Z[0],qa[0],ia[1],Z[1],qa[1],ia[2],Z[2],qa[2])}}else if("l"===h){F=m.substring(1).trim().split(" ");U=[];W=[];if(-1===m.indexOf("/"))U=F;else for(ia=0,Z=F.length;ia<Z;ia++)qa=F[ia].split("/"),""!==qa[0]&&U.push(qa[0]),""!==qa[1]&&W.push(qa[1]);f.addLineGeometry(U,
W)}else"p"===h?(w=m.substr(1).trim().split(" "),f.addPointGeometry(w)):null!==(A=l.exec(m))?(H=(" "+A[0].substr(1).trim()).substr(1),f.startObject(H)):q.test(m)?f.object.startMaterial(m.substring(7).trim(),f.materialLibraries):k.test(m)?f.materialLibraries.push(m.substring(7).trim()):x.test(m)?console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.'):"s"===h?(1<(A=m.split(" ")).length?(H=A[1].trim().toLowerCase(),f.object.smooth="0"!==H&&
"off"!==H):f.object.smooth=!0,(Y=f.object.currentMaterial())&&(Y.smooth=f.object.smooth)):"\x00"!==m&&console.warn('THREE.OBJLoader: Unexpected line: "'+m+'"');f.finalize();h=new THREE.Group;h.materialLibraries=[].concat(f.materialLibraries);c=0;for(J=f.objects.length;c<J;c++)if(p=f.objects[c],Y=p.geometry,w=p.materials,H="Line"===Y.type,L="Points"===Y.type,m=!1,0!==Y.vertices.length){A=new THREE.BufferGeometry;A.setAttribute("position",new THREE.Float32BufferAttribute(Y.vertices,3));A.setAttribute("normal",
new THREE.Float32BufferAttribute(Y.normals,3));0<Y.colors.length&&(m=!0,A.setAttribute("color",new THREE.Float32BufferAttribute(Y.colors,3)));!0===Y.hasUVIndices&&A.setAttribute("uv",new THREE.Float32BufferAttribute(Y.uvs,2));I=[];F=0;for(U=w.length;F<U;F++){var ma;W=(da=w[F]).name+"_"+da.smooth+"_"+m;var Y=f.materials[W];null!==this.materials&&(Y=this.materials.create(da.name),!H||!Y||Y instanceof THREE.LineBasicMaterial?!L||!Y||Y instanceof THREE.PointsMaterial||(ma=new THREE.PointsMaterial({size:10,
sizeAttenuation:!1}),THREE.Material.prototype.copy.call(ma,Y),ma.color.copy(Y.color),ma.map=Y.map,Y=ma):(ma=new THREE.LineBasicMaterial,THREE.Material.prototype.copy.call(ma,Y),ma.color.copy(Y.color),Y=ma));void 0===Y&&((Y=H?new THREE.LineBasicMaterial:L?new THREE.PointsMaterial({size:1,sizeAttenuation:!1}):new THREE.MeshPhongMaterial).name=da.name,Y.flatShading=!da.smooth,Y.vertexColors=m,f.materials[W]=Y);I.push(Y)}if(1<I.length){F=0;for(U=w.length;F<U;F++){var da=w[F];A.addGroup(da.groupStart,
da.groupCount,F)}Y=new (H?THREE.LineSegments:L?THREE.Points:THREE.Mesh)(A,I)}else Y=new (H?THREE.LineSegments:L?THREE.Points:THREE.Mesh)(A,I[0]);Y.name=p.name;h.add(Y)}return h}}),b}();var xb=function(e,b){for(var l="616e616c 617373 6175746973 62616c73 62616c7a 626c77 626c6f776a6f62 626f6e6572 6269746368 746974 627574 6368696e616d656e 6368696e616d616e 6368696e6b 636f636b 63756d 63756e74 64696b 6469636b 64796b65 656a6163756c6174 6572656374696f6e 666167 666774 66676574 666774 66676f74 66617274 66656c6174696f 666f7265736b696e 666f72736b696e 34736b696e 666f7265736b6e 666f72736b6e 34736b6e 666b 66756b 667563 66636b 6675646765706163 66756765706163 667567706163 667564676570636b 66646770636b 676179 6761796c6f72 6761796c72 67796c7264 676f6f6b 68616e646a6f62 686562 6869746c6572 68746c72 6869746c72 68746c6572 6a696761 6a69676761 6a676761 6a676162 6a697a 6b696b65 6d617374657262617465 6d617374757262617465 6d6173747262617465 6d61737475726238 6d61737465726238 6d617374726238 6d6964676574 6a65726b6f66 6a61636b6f66 6a61636b6d656f66 626561746d656174 6265746d6574 6d6574626574 6d65617462656174 6d6f6c657374 6e617a69 6e7a69 6e6772 6e676572 6e6761 6e656772 6e6967 6e6767 6e7574 70616b69 70656e6973 70657276 7068756b 70687563 706863 70696d70 70697373 706f7263686d6f6e6b6579 707263686d6e6b79 706f7263686d6e6b79 707263686d6f6e6b6579 706f7263686d6e6b6579 707263686d6f6e6b6579 706f726e 70726963 707269636b 70726f737469 70757379 7075736965 7065646f 70646f 72617065 7261706973 726170696e 72656374756d 74617264 72696d696e67 72696d6a6f62 736578 7365636b73 7363726f74756d 736b616e6b 736c617665 736c7574 736f646f6d 73706963 73686974 736874 7375636b 737578 73756b73 7370756e6b 73706f6765 7377617374696b61 73797068 746573746963 74657374696b 77616e6b 77686f7265 7768747077 776869746570726964 77686974707264 7768697465706f77 77686974657077 77707777 79656c6f776d616e 7a696761626f 7a6970657268656164 6a65737573 6a77 6a6577 61726162 6d75736c696d 636872697374 736174616e 676f64 6c6f7264 616c6168 62756468 6269626c65 71756172616e 736d676d61 736d65676d61".split(" "),
k="a4 g6 g9 s5 i1 l1 b8 t7 b6 s$ y$ g& a& b& i! i/ i\\ i? g8 b8 s6 o0 e3".split(" "),q=e.toLowerCase(),x=0;x<q.length;x++){var n=q.charCodeAt(x);if(122<n||57<n&&61>n||33>n||40==n||41==n)return"";n="";for(var E=x;E<q.length;E++){q.charAt(E);var B=q.charCodeAt(E);(48<=B&&57>=B||97<=B&&122>=B)&&(n+=B.toString(16));for(B=0;B<l.length;B++){for(var y="",g="",c=[],f=0,h=0,p=0;p<l[B].length;p+=2){var w=n.charAt(p+f)+n.charAt(p+1+f),H=l[B].charAt(p)+l[B].charAt(p+1);if((w===y||w===g)&&0!==w.length&&(h++,0<
h))for(;w===y||w===g;)f+=2,w=n.charAt(p+f)+n.charAt(p+1+f);if(w===H)c[p/2]=!0,y=w,g=H;else{c[p/2]=!1;for(var L=0;L<k.length;L++){var m=k[L].charCodeAt(1).toString(16),A=k[L].charCodeAt(0).toString(16);w===m&&(A===H?(c[p/2]=!0,y=m,g=H):A!==y&&A!==g||(h++,0<h&&(f+=2,p-=2)))}!1===c[p/2]&&(p=l[B].length)}}for(g=y=0;g<c.length;g++)if(!0===c[g]&&y++,y===c.length)return""}}}return e},ua={dt:1,start:window.performance.now(),time:0,last:0,timestep:0,reset:function(){ua.start=window.performance.now();ua.time=
0;ua.last=0;ua.timestep=1E3/60;ua.dt=1}},mb=function(){return ua.time=window.performance.now()-ua.start,ua.timestep=ua.time-ua.last,ua.dt=ua.timestep/(1E3/60),2<ua.dt&&(ua.dt=2),ua.last=ua.time,ua.dt};ua.convert=function(e){e=void 0===e?[]:e;for(var b="[\n",l=0;l<e.length;l++){b+="'";for(var k=0;k<e[l].length;k++)b+=e[l].charCodeAt(k).toString(16);b+="',\n"}return b+="]",console.log(b),b}})();